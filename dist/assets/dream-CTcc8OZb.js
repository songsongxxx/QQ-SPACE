import"./modulepreload-polyfill-B5Qt9EMX.js";const za="modulepreload",Ga=function(n,e){return new URL(n,e).href},yi={},is=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(l=>{if(l=Ga(l,s),l in yi)return;yi[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(!!s)for(let p=o.length-1;p>=0;p--){const m=o[p];if(m.href===l&&(!u||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":za,u||(f.as="script"),f.crossOrigin="",f.href=l,c&&f.setAttribute("nonce",c),document.head.appendChild(f),u)return new Promise((p,m)=>{f.addEventListener("load",p),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Ha=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>is(async()=>{const{default:s}=await Promise.resolve().then(()=>ps);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class br extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Ja extends br{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Za extends br{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Xa extends br{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var tr;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(tr||(tr={}));var Ya=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};class Ka{constructor(e,{headers:t={},customFetch:s,region:r=tr.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=Ha(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ya(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:o}=t;let a={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(a["x-region"]=c);let l;o&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),r),body:l}).catch(p=>{throw new Ja(p)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Za(u);if(!u.ok)throw new Xa(u);let d=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield u.json():d==="application/octet-stream"?f=yield u.blob():d==="text/event-stream"?f=u:d==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(r){return{data:null,error:r}}})}}function Qa(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ec(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var ge={},$t={},qt={},Ut={},Bt={},Wt={},tc=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},os=tc();const sc=os.fetch,ho=os.fetch.bind(os),fo=os.Headers,nc=os.Request,rc=os.Response,ps=Object.freeze(Object.defineProperty({__proto__:null,Headers:fo,Request:nc,Response:rc,default:ho,fetch:sc},Symbol.toStringTag,{value:"Module"})),ic=ec(ps);var Ys={},vi;function po(){if(vi)return Ys;vi=1,Object.defineProperty(Ys,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Ys.default=n,Ys}var wi;function mo(){if(wi)return Wt;wi=1;var n=Wt&&Wt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wt,"__esModule",{value:!0});const e=n(ic),t=n(po());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let c=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,h,d;let f=null,p=null,m=null,_=l.status,y=l.statusText;if(l.ok){if(this.method!=="HEAD"){const g=await l.text();g===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?p=g:p=JSON.parse(g))}const k=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),S=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");k&&S&&S.length>1&&(m=parseInt(S[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(f={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,m=null,_=406,y="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const k=await l.text();try{f=JSON.parse(k),Array.isArray(f)&&l.status===404&&(p=[],f=null,_=200,y="OK")}catch{l.status===404&&k===""?(_=204,y="No Content"):f={message:k}}if(f&&this.isMaybeSingle&&(!((d=f==null?void 0:f.details)===null||d===void 0)&&d.includes("0 rows"))&&(f=null,_=200,y="OK"),f&&this.shouldThrowOnError)throw new t.default(f)}return{error:f,data:p,count:m,status:_,statusText:y}});return this.shouldThrowOnError||(c=c.catch(l=>{var u,h,d;return{error:{message:`${(u=l==null?void 0:l.name)!==null&&u!==void 0?u:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(h=l==null?void 0:l.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(d=l==null?void 0:l.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,o)}returns(){return this}overrideTypes(){return this}}return Wt.default=s,Wt}var bi;function _o(){if(bi)return Bt;bi=1;var n=Bt&&Bt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Bt,"__esModule",{value:!0});const e=n(mo());class t extends e.default{select(r){let i=!1;const o=(r??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:c=a}={}){const l=c?`${c}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${r}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${r}`),this}range(r,i,{foreignTable:o,referencedTable:a=o}={}){const c=typeof a>"u"?"offset":`${a}.offset`,l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(c,`${r}`),this.url.searchParams.set(l,`${i-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:c=!1,format:l="text"}={}){var u;const h=[r?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,c?"wal":null].filter(Boolean).join("|"),d=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${d}"; options=${h};`,l==="json"?this:this}rollback(){var r;return((r=this.headers.Prefer)!==null&&r!==void 0?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Bt.default=t,Bt}var Ti;function Tr(){if(Ti)return Ut;Ti=1;var n=Ut&&Ut.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ut,"__esModule",{value:!0});const e=n(_o());class t extends e.default{eq(r,i){return this.url.searchParams.append(r,`eq.${i}`),this}neq(r,i){return this.url.searchParams.append(r,`neq.${i}`),this}gt(r,i){return this.url.searchParams.append(r,`gt.${i}`),this}gte(r,i){return this.url.searchParams.append(r,`gte.${i}`),this}lt(r,i){return this.url.searchParams.append(r,`lt.${i}`),this}lte(r,i){return this.url.searchParams.append(r,`lte.${i}`),this}like(r,i){return this.url.searchParams.append(r,`like.${i}`),this}likeAllOf(r,i){return this.url.searchParams.append(r,`like(all).{${i.join(",")}}`),this}likeAnyOf(r,i){return this.url.searchParams.append(r,`like(any).{${i.join(",")}}`),this}ilike(r,i){return this.url.searchParams.append(r,`ilike.${i}`),this}ilikeAllOf(r,i){return this.url.searchParams.append(r,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(r,i){return this.url.searchParams.append(r,`ilike(any).{${i.join(",")}}`),this}is(r,i){return this.url.searchParams.append(r,`is.${i}`),this}in(r,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(r,`in.(${o})`),this}contains(r,i){return typeof i=="string"?this.url.searchParams.append(r,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(r,`cs.{${i.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(i)}`),this}containedBy(r,i){return typeof i=="string"?this.url.searchParams.append(r,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(r,`cd.{${i.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(i)}`),this}rangeGt(r,i){return this.url.searchParams.append(r,`sr.${i}`),this}rangeGte(r,i){return this.url.searchParams.append(r,`nxl.${i}`),this}rangeLt(r,i){return this.url.searchParams.append(r,`sl.${i}`),this}rangeLte(r,i){return this.url.searchParams.append(r,`nxr.${i}`),this}rangeAdjacent(r,i){return this.url.searchParams.append(r,`adj.${i}`),this}overlaps(r,i){return typeof i=="string"?this.url.searchParams.append(r,`ov.${i}`):this.url.searchParams.append(r,`ov.{${i.join(",")}}`),this}textSearch(r,i,{config:o,type:a}={}){let c="";a==="plain"?c="pl":a==="phrase"?c="ph":a==="websearch"&&(c="w");const l=o===void 0?"":`(${o})`;return this.url.searchParams.append(r,`${c}fts${l}.${i}`),this}match(r){return Object.entries(r).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(r,i,o){return this.url.searchParams.append(r,`not.${i}.${o}`),this}or(r,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${r})`),this}filter(r,i,o){return this.url.searchParams.append(r,`${i}.${o}`),this}}return Ut.default=t,Ut}var ki;function go(){if(ki)return qt;ki=1;var n=qt&&qt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(qt,"__esModule",{value:!0});const e=n(Tr());class t{constructor(r,{headers:i={},schema:o,fetch:a}){this.url=r,this.headers=i,this.schema=o,this.fetch=a}select(r,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let c=!1;const l=(r??"*").split("").map(u=>/\s/.test(u)&&!c?"":(u==='"'&&(c=!c),u)).join("");return this.url.searchParams.set("select",l),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:i,defaultToNull:o=!0}={}){const a="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(r)){const l=r.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(l.length>0){const u=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:c=!0}={}){const l="POST",u=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),c||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(r)){const h=r.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(h.length>0){const d=[...new Set(h)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const i="DELETE",o=[];return r&&o.push(`count=${r}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return qt.default=t,qt}var ks={},Ss={},Si;function oc(){return Si||(Si=1,Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.version=void 0,Ss.version="0.0.0-automated"),Ss}var Ci;function ac(){if(Ci)return ks;Ci=1,Object.defineProperty(ks,"__esModule",{value:!0}),ks.DEFAULT_HEADERS=void 0;const n=oc();return ks.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},ks}var Ai;function cc(){if(Ai)return $t;Ai=1;var n=$t&&$t.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty($t,"__esModule",{value:!0});const e=n(go()),t=n(Tr()),s=ac();class r{constructor(o,{headers:a={},schema:c,fetch:l}={}){this.url=o,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),a),this.schemaName=c,this.fetch=l}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new r(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:c=!1,get:l=!1,count:u}={}){let h;const d=new URL(`${this.url}/rpc/${o}`);let f;c||l?(h=c?"HEAD":"GET",Object.entries(a).filter(([m,_])=>_!==void 0).map(([m,_])=>[m,Array.isArray(_)?`{${_.join(",")}}`:`${_}`]).forEach(([m,_])=>{d.searchParams.append(m,_)})):(h="POST",f=a);const p=Object.assign({},this.headers);return u&&(p.Prefer=`count=${u}`),new t.default({method:h,url:d,headers:p,schema:this.schemaName,body:f,fetch:this.fetch,allowEmpty:!1})}}return $t.default=r,$t}var xi;function lc(){if(xi)return ge;xi=1;var n=ge&&ge.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ge,"__esModule",{value:!0}),ge.PostgrestError=ge.PostgrestBuilder=ge.PostgrestTransformBuilder=ge.PostgrestFilterBuilder=ge.PostgrestQueryBuilder=ge.PostgrestClient=void 0;const e=n(cc());ge.PostgrestClient=e.default;const t=n(go());ge.PostgrestQueryBuilder=t.default;const s=n(Tr());ge.PostgrestFilterBuilder=s.default;const r=n(_o());ge.PostgrestTransformBuilder=r.default;const i=n(mo());ge.PostgrestBuilder=i.default;const o=n(po());return ge.PostgrestError=o.default,ge.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:r.default,PostgrestBuilder:i.default,PostgrestError:o.default},ge}var uc=lc();const hc=Qa(uc),{PostgrestClient:dc,PostgrestQueryBuilder:Xm,PostgrestFilterBuilder:Ym,PostgrestTransformBuilder:Km,PostgrestBuilder:Qm,PostgrestError:e_}=hc,fc="2.11.2",pc={"X-Client-Info":`realtime-js/${fc}`},mc="1.0.0",yo=1e4,_c=1e3;var ts;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ts||(ts={}));var De;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(De||(De={}));var $e;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})($e||($e={}));var sr;(function(n){n.websocket="websocket"})(sr||(sr={}));var xt;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(xt||(xt={}));class gc{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+r));o=o+r;const c=s.decode(e.slice(o,o+i));o=o+i;const l=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}}class vo{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var se;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(se||(se={}));const Oi=(n,e,t={})=>{var s;const r=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=yc(o,n,e,r),i),{})},yc=(n,e,t,s)=>{const r=e.find(a=>a.name===n),i=r==null?void 0:r.type,o=t[n];return i&&!s.includes(i)?wo(i,o):nr(o)},wo=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Tc(e,t)}switch(n){case se.bool:return vc(e);case se.float4:case se.float8:case se.int2:case se.int4:case se.int8:case se.numeric:case se.oid:return wc(e);case se.json:case se.jsonb:return bc(e);case se.timestamp:return kc(e);case se.abstime:case se.date:case se.daterange:case se.int4range:case se.int8range:case se.money:case se.reltime:case se.text:case se.time:case se.timestamptz:case se.timetz:case se.tsrange:case se.tstzrange:return nr(e);default:return nr(e)}},nr=n=>n,vc=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},wc=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},bc=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Tc=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>wo(e,a))}return n},kc=n=>typeof n=="string"?n.replace(" ","T"):n,bo=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Gn{constructor(e,t,s={},r=yo){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ei;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Ei||(Ei={}));class As{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=As.syncState(this.state,r,i,o),this.pendingDiffs.forEach(c=>{this.state=As.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},r=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=As.syncDiff(this.state,r,i,o),a())}),this.onJoin((r,i,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:o})}),this.onLeave((r,i,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(l,u)=>{o[l]||(c[l]=u)}),this.map(o,(l,u)=>{const h=i[l];if(h){const d=u.map(_=>_.presence_ref),f=h.map(_=>_.presence_ref),p=u.filter(_=>f.indexOf(_.presence_ref)<0),m=h.filter(_=>d.indexOf(_.presence_ref)<0);p.length>0&&(a[l]=p),m.length>0&&(c[l]=m)}else a[l]=u}),this.syncDiff(i,{joins:a,leaves:c},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(a,c)=>{var l;const u=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),u.length>0){const h=e[a].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}s(a,u,c)}),this.map(o,(a,c)=>{let l=e[a];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=l,r(a,l,c),l.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return"metas"in r?t[s]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ii;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ii||(Ii={}));var Ni;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ni||(Ni={}));var st;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(st||(st={}));class kr{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=De.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Gn(this,$e.join,this.params,this.timeout),this.rejoinTimer=new vo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=De.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=De.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=De.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=De.errored,this.rejoinTimer.scheduleTimeout())}),this._on($e.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new As(this),this.broadcastEndpointURL=bo(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(u=>e==null?void 0:e(st.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(st.CLOSED));const c={},l={broadcast:i,presence:o,postgres_changes:(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&r!==void 0?r:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(st.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(h=d==null?void 0:d.length)!==null&&h!==void 0?h:0,p=[];for(let m=0;m<f;m++){const _=d[m],{filter:{event:y,schema:T,table:k,filter:S}}=_,g=u&&u[m];if(g&&g.event===y&&g.schema===T&&g.table===k&&g.filter===S)p.push(Object.assign(Object.assign({},_),{id:g.id}));else{this.unsubscribe(),e==null||e(st.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(st.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(st.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(st.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((r=l.body)===null||r===void 0?void 0:r.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=De.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger($e.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const r=new Gn(this,$e.leave,{},e);r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout(()=>r.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Gn(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:u}=$e;if(s&&[a,c,l,u].indexOf(o)>=0&&s!==this._joinRef())return;let d=this._onMessage(o,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(f=>{var p,m,_;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((_=(m=f.filter)===null||m===void 0?void 0:m.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(f=>f.callback(d,s)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var p,m,_,y,T,k;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const S=f.id,g=(p=f.filter)===null||p===void 0?void 0:p.event;return S&&((m=t.ids)===null||m===void 0?void 0:m.includes(S))&&(g==="*"||(g==null?void 0:g.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const S=(T=(y=f==null?void 0:f.filter)===null||y===void 0?void 0:y.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return S==="*"||S===((k=t==null?void 0:t.event)===null||k===void 0?void 0:k.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:m,table:_,commit_timestamp:y,type:T,errors:k}=p;d=Object.assign(Object.assign({},{schema:m,table:_,commit_timestamp:y,eventType:T,new:{},old:{},errors:k}),this._getPayloadRecords(p))}f.callback(d,s)})}_isClosed(){return this.state===De.closed}_isJoined(){return this.state===De.joined}_isJoining(){return this.state===De.joining}_isLeaving(){return this.state===De.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&kr.isEqual(r.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on($e.close,{},e)}_onError(e){this._on($e.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=De.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Oi(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Oi(e.columns,e.old_record)),t}}const Sc=()=>{},Cc=typeof WebSocket<"u",Ac=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class xc{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=pc,this.params={},this.timeout=yo,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Sc,this.conn=null,this.sendBuffer=[],this.serializer=new gc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>is(async()=>{const{default:c}=await Promise.resolve().then(()=>ps);return{default:c}},void 0,import.meta.url).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${sr.websocket}`,this.httpEndpoint=bo(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new vo(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Cc){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Oc(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),is(async()=>{const{default:e}=await import("./browser-CDQIVL-i.js").then(t=>t.b);return{default:e}},[],import.meta.url).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:mc}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case ts.connecting:return xt.Connecting;case ts.open:return xt.Open;case ts.closing:return xt.Closing;default:return xt.Closed}}isConnected(){return this.connectionState()===xt.Open}channel(e,t={config:{}}){const s=new kr(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:r,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(r=>{t&&r.updateJoinPayload({access_token:t}),r.joinedOnce&&r._isJoined()&&r._push($e.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(_c,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:r,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${r} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(s)).forEach(a=>a._trigger(r,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger($e.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Ac],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Oc{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ts.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class Sr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ye(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ec extends Sr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class rr extends Sr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ic=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const To=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>is(async()=>{const{default:s}=await Promise.resolve().then(()=>ps);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Nc=()=>Ic(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield is(()=>Promise.resolve().then(()=>ps),void 0,import.meta.url)).Response:Response}),ir=n=>{if(Array.isArray(n))return n.map(t=>ir(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=ir(s)}),e};var Pt=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const Hn=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Rc=(n,e,t)=>Pt(void 0,void 0,void 0,function*(){const s=yield Nc();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(r=>{e(new Ec(Hn(r),n.status||500))}).catch(r=>{e(new rr(Hn(r),r))}):e(new rr(Hn(n),n))}),Dc=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(r.body=JSON.stringify(s)),Object.assign(Object.assign({},r),t))};function js(n,e,t,s,r,i){return Pt(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Dc(e,s,r,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Rc(c,a,s))})})}function ln(n,e,t,s){return Pt(this,void 0,void 0,function*(){return js(n,"GET",e,t,s)})}function pt(n,e,t,s,r){return Pt(this,void 0,void 0,function*(){return js(n,"POST",e,s,r,t)})}function Pc(n,e,t,s,r){return Pt(this,void 0,void 0,function*(){return js(n,"PUT",e,s,r,t)})}function Mc(n,e,t,s){return Pt(this,void 0,void 0,function*(){return js(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function ko(n,e,t,s,r){return Pt(this,void 0,void 0,function*(){return js(n,"DELETE",e,s,r,t)})}var xe=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const jc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ri={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Fc{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=To(r)}uploadOrUpdate(e,t,s,r){return xe(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ri),r);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),r!=null&&r.headers&&(a=Object.assign(Object.assign({},a),r.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),d=yield h.json();return h.ok?{data:{path:l,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(i){if(ye(i))return{data:null,error:i};throw i}})}upload(e,t,s){return xe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return xe(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:Ri.upsert},r),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:u}),d=yield h.json();return h.ok?{data:{path:i,fullPath:d.Key},error:null}:{data:null,error:d}}catch(c){if(ye(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return xe(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);t!=null&&t.upsert&&(r["x-upsert"]="true");const i=yield pt(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Sr("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}update(e,t,s){return xe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return xe(this,void 0,void 0,function*(){try{return{data:yield pt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}})}copy(e,t,s){return xe(this,void 0,void 0,function*(){try{return{data:{path:(yield pt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return xe(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield pt(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return xe(this,void 0,void 0,function*(){try{const r=yield pt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:r.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}})}download(e,t){return xe(this,void 0,void 0,function*(){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield ln(this.fetch,`${this.url}/${r}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(ye(a))return{data:null,error:a};throw a}})}info(e){return xe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield ln(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ir(s),error:null}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}exists(e){return xe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Mc(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(ye(s)&&s instanceof rr){const r=s.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&r.push(c);let l=r.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${l}`)}}}remove(e){return xe(this,void 0,void 0,function*(){try{return{data:yield ko(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}list(e,t,s){return xe(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},jc),t),{prefix:e||""});return{data:yield pt(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Vc="2.7.1",Lc={"X-Client-Info":`storage-js/${Vc}`};var zt=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};class $c{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Lc),t),this.fetch=To(s)}listBuckets(){return zt(this,void 0,void 0,function*(){try{return{data:yield ln(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ye(e))return{data:null,error:e};throw e}})}getBucket(e){return zt(this,void 0,void 0,function*(){try{return{data:yield ln(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return zt(this,void 0,void 0,function*(){try{return{data:yield pt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return zt(this,void 0,void 0,function*(){try{return{data:yield Pc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(ye(s))return{data:null,error:s};throw s}})}emptyBucket(e){return zt(this,void 0,void 0,function*(){try{return{data:yield pt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}deleteBucket(e){return zt(this,void 0,void 0,function*(){try{return{data:yield ko(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}})}}class qc extends $c{constructor(e,t={},s){super(e,t,s)}from(e){return new Fc(this.url,this.headers,e,this.fetch)}}const Uc="2.49.4";let Cs="";typeof Deno<"u"?Cs="deno":typeof document<"u"?Cs="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Cs="react-native":Cs="node";const Bc={"X-Client-Info":`supabase-js-${Cs}/${Uc}`},Wc={headers:Bc},zc={schema:"public"},Gc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Hc={};var Jc=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};const Zc=n=>{let e;return n?e=n:typeof fetch>"u"?e=ho:e=fetch,(...t)=>e(...t)},Xc=()=>typeof Headers>"u"?fo:Headers,Yc=(n,e,t)=>{const s=Zc(t),r=Xc();return(i,o)=>Jc(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let l=new r(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},o),{headers:l}))})};var Kc=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};function Qc(n){return n.replace(/\/$/,"")}function el(n,e){const{db:t,auth:s,realtime:r,global:i}=n,{db:o,auth:a,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},c),r),global:Object.assign(Object.assign({},l),i),accessToken:()=>Kc(this,void 0,void 0,function*(){return""})};return n.accessToken?u.accessToken=n.accessToken:delete u.accessToken,u}const So="2.69.1",Zt=30*1e3,or=3,Jn=or*Zt,tl="http://localhost:9999",sl="supabase.auth.token",nl={"X-Client-Info":`gotrue-js/${So}`},ar="X-Supabase-Api-Version",Co={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},rl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,il=6e5;class Cr extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function U(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class ol extends Cr{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function al(n){return U(n)&&n.name==="AuthApiError"}class Ao extends Cr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class vt extends Cr{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class dt extends vt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function cl(n){return U(n)&&n.name==="AuthSessionMissingError"}class Zn extends vt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ks extends vt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Qs extends vt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ll(n){return U(n)&&n.name==="AuthImplicitGrantRedirectError"}class Di extends vt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class cr extends vt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Xn(n){return U(n)&&n.name==="AuthRetryableFetchError"}class Pi extends vt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class xs extends vt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Mi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ji=` 	
\r=`.split(""),ul=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<ji.length;e+=1)n[ji[e].charCodeAt(0)]=-2;for(let e=0;e<Mi.length;e+=1)n[Mi[e].charCodeAt(0)]=e;return n})();function xo(n,e,t){const s=ul[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Fi(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=o=>{fl(o,s,t)};for(let o=0;o<n.length;o+=1)xo(n.charCodeAt(o),r,i);return e.join("")}function hl(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function dl(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const r=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}hl(s,e)}}function fl(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if((n>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function pl(n){const e=[],t={queue:0,queuedBits:0},s=r=>{e.push(r)};for(let r=0;r<n.length;r+=1)xo(n.charCodeAt(r),t,s);return new Uint8Array(e)}function ml(n){const e=[];return dl(n,t=>e.push(t)),new Uint8Array(e)}function _l(n){return Math.round(Date.now()/1e3)+n}function gl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Je=()=>typeof window<"u"&&typeof document<"u",Ct={tested:!1,writable:!1},Os=()=>{if(!Je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ct.tested)return Ct.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ct.tested=!0,Ct.writable=!0}catch{Ct.tested=!0,Ct.writable=!1}return Ct.writable};function yl(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((s,r)=>{e[r]=s}),e}const Oo=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>is(async()=>{const{default:s}=await Promise.resolve().then(()=>ps);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},vl=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Eo=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},en=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},tn=async(n,e)=>{await n.removeItem(e)};class Cn{constructor(){this.promise=new Cn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Cn.promiseConstructor=Promise;function Yn(n){const e=n.split(".");if(e.length!==3)throw new xs("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!rl.test(e[s]))throw new xs("JWT not in base64url format");return{header:JSON.parse(Fi(e[0])),payload:JSON.parse(Fi(e[1])),signature:pl(e[2]),raw:{header:e[0],payload:e[1]}}}async function wl(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function bl(n,e){return new Promise((s,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){r(o);return}}})()})}function Tl(n){return("0"+n.toString(16)).substr(-2)}function kl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(e),Array.from(e,Tl).join("")}async function Sl(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function Cl(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Sl(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Gt(n,e,t=!1){const s=kl();let r=s;t&&(r+="/PASSWORD_RECOVERY"),await Eo(n,`${e}-code-verifier`,r);const i=await Cl(s);return[i,s===i?"plain":"s256"]}const Al=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function xl(n){const e=n.headers.get(ar);if(!e||!e.match(Al))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ol(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function El(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var Il=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const At=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Nl=[502,503,504];async function Vi(n){var e;if(!vl(n))throw new cr(At(n),0);if(Nl.includes(n.status))throw new cr(At(n),n.status);let t;try{t=await n.json()}catch(i){throw new Ao(At(i),i)}let s;const r=xl(n);if(r&&r.getTime()>=Co["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Pi(At(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new dt}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Pi(At(t),n.status,t.weak_password.reasons);throw new ol(At(t),n.status||500,s)}const Rl=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),t))};async function G(n,e,t,s){var r;const i=Object.assign({},s==null?void 0:s.headers);i[ar]||(i[ar]=Co["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(r=s==null?void 0:s.query)!==null&&r!==void 0?r:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Dl(n,e,t+a,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Dl(n,e,t,s,r,i){const o=Rl(e,s,r,i);let a;try{a=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new cr(At(c),0)}if(a.ok||await Vi(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(c){await Vi(c)}}function ft(n){var e;let t=null;Fl(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=_l(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function Li(n){const e=ft(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function _t(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Pl(n){return{data:n,error:null}}function Ml(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i}=n,o=Il(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function jl(n){return n}function Fl(n){return n.access_token&&n.refresh_token&&n.expires_in}var Vl=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class Ll{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Oo(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await G(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(U(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await G(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_t})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Vl(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=s==null?void 0:s.newEmail,delete r.newEmail),await G(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:Ml,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(U(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await G(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_t})}catch(t){if(U(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,o,a,c;try{const l={nextPage:null,lastPage:0,total:0},u=await G(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:jl});if(u.error)throw u.error;const h=await u.json(),d=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(c=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(p.split(";")[1].split("=")[1]);l[`${_}Page`]=m}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(U(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await G(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_t})}catch(t){if(U(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await G(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_t})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await G(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_t})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await G(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:s}}catch(t){if(U(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await G(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}}}const $l={getItem:n=>Os()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Os()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Os()&&globalThis.localStorage.removeItem(n)}};function $i(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function ql(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ht={debug:!!(globalThis&&Os()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Io extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ul extends Io{}async function Bl(n,e,t){Ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Ht.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async r=>{if(r){Ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return await t()}finally{Ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(e===0)throw Ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Ul(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Ht.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}ql();const Wl={url:tl,storageKey:sl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:nl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function qi(n,e,t){return await t()}class Ns{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ns.nextInstanceID,Ns.nextInstanceID+=1,this.instanceID>0&&Je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Wl),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Ll({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Oo(r.fetch),this.lock=r.lock||qi,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Je()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Bl:this.lock=qi,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:Os()?this.storage=$l:(this.memoryStorage={},this.storage=$i(this.memoryStorage)):(this.memoryStorage={},this.storage=$i(this.memoryStorage)),Je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${So}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=yl(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Je()&&this.detectSessionInUrl&&s!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),ll(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return U(t)?{error:t}:{error:new Ao("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await G(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:ft}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(U(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Gt(this.storage,this.storageKey)),i=await G(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:p},xform:ft})}else if("phone"in e){const{phone:u,password:h,options:d}=e;i=await G(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(r=d==null?void 0:d.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:ft})}else throw new Ks("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(U(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await G(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Li})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await G(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Li})}else throw new Ks("You must provide either an email or phone number and a password");const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Zn}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await en(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(t??"").split("/");try{const{data:i,error:o}=await G(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ft});if(await tn(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Zn}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:o})}catch(i){if(U(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:o}=e,a=await G(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ft}),{data:c,error:l}=a;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Zn}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,o;try{if("email"in e){const{email:a,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Gt(this.storage,this.storageKey));const{error:h}=await G(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:c}=e,{data:l,error:u}=await G(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Ks("You must provide either an email or phone number.")}catch(a){if(U(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await G(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:ft});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,l=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(U(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Gt(this.storage,this.storageKey)),await G(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Pl})}catch(i){if(U(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new dt;const{error:r}=await G(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(U(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:o}=await G(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:r,options:i}=e,{data:o,error:a}=await G(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Ks("You must provide either an email or phone number and a type")}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await en(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Jn:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!o&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await G(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_t}):await this._useSession(async t=>{var s,r,i;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new dt}:await G(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:_t})})}catch(t){if(U(t))return cl(t)&&(await this._removeSession(),await tn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new dt;const o=r.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await Gt(this.storage,this.storageKey));const{data:l,error:u}=await G(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:_t});if(u)throw u;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new dt;const t=Date.now()/1e3;let s=t,r=!0,i=null;const{payload:o}=Yn(e.access_token);if(o.exp&&(s=o.exp,r=s<=t),r){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(U(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new dt;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Je())throw new Qs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Qs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Di("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Qs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Di("No code detected.");const{data:T,error:k}=await this._exchangeCodeForSession(e.code);if(k)throw k;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:l}=e;if(!i||!a||!o||!l)throw new Qs("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;c&&(d=parseInt(c));const f=d-u;f*1e3<=Zt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const p=d-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,u);const{data:m,error:_}=await this._getUser(i);if(_)throw _;const y={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:h,expires_at:d,refresh_token:o,token_type:l,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(s){if(U(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await en(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const o=(s=r.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(al(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await tn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=gl(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;this.flowType==="pkce"&&([s,r]=await Gt(this.storage,this.storageKey,!0));try{return await G(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(U(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async i=>{var o,a,c,l,u;const{data:h,error:d}=i;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await G(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(r)throw r;return Je()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(U(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:o}=t;if(o)throw o;return await G(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(U(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await bl(async r=>(r>0&&await wl(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await G(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ft})),(r,i)=>{const o=200*Math.pow(2,r);return i&&Xn(i)&&Date.now()+o-s<Zt})}catch(s){if(this._debug(t,"error",s),U(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Je()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await en(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const r=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Jn;if(this._debug(t,`session has${r?"":" not"} expired with margin of ${Jn}s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),Xn(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new dt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Cn;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new dt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(r,"error",i),U(i)){const o={session:null,error:i};return Xn(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Eo(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await tn(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Je()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Zt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-e)/Zt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${Zt}ms, refresh threshold is ${or} ticks`),r<=or&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Io)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Je()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Gt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);r.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await G(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(U(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await G(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((r=c==null?void 0:c.totp)===null||r===void 0)&&r.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(U(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await G(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(U(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await G(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(U(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],r=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Yn(r.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((s=(t=r.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+il>Date.now()))return s;const{data:r,error:i}=await G(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!r.keys||r.keys.length===0)throw new xs("JWKS is empty");if(this.jwks=r,this.jwks_cached_at=Date.now(),s=r.keys.find(o=>o.kid===e),!s)throw new xs("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:f,error:p}=await this.getSession();if(p||!f.session)return{data:null,error:p};s=f.session.access_token}const{header:r,payload:i,signature:o,raw:{header:a,payload:c}}=Yn(s);if(Ol(i.exp),!r.kid||r.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:i,header:r,signature:o},error:null}}const l=El(r.alg),u=await this.fetchJwk(r.kid,t),h=await crypto.subtle.importKey("jwk",u,l,!0,["verify"]);if(!await crypto.subtle.verify(l,h,o,ml(`${a}.${c}`)))throw new xs("Invalid JWT signature");return{data:{claims:i,header:r,signature:o},error:null}}catch(s){if(U(s))return{data:null,error:s};throw s}}}Ns.nextInstanceID=0;const zl=Ns;class Gl extends zl{constructor(e){super(e)}}var Hl=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})};class Jl{constructor(e,t,s){var r,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Qc(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:zc,realtime:Hc,auth:Object.assign(Object.assign({},Gc),{storageKey:c}),global:Wc},u=el(s??{},l);this.storageKey=(r=u.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=Yc(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new dc(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Ka(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new qc(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Hl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:o,lock:a,debug:c},l,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Gl({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:o,lock:a,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new xc(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Zl=(n,e,t)=>new Jl(n,e,t),No="15.0.4",Ui=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),Bi=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),lr=(n,e)=>({startTime:e,type:"setValue",value:n}),Ro=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),Do=(n,e,{startTime:t,target:s,timeConstant:r})=>s+(e-s)*Math.exp((t-n)/r),Yt=n=>n.type==="exponentialRampToValue",un=n=>n.type==="linearRampToValue",mt=n=>Yt(n)||un(n),Ar=n=>n.type==="setValue",nt=n=>n.type==="setValueCurve",hn=(n,e,t,s)=>{const r=n[e];return r===void 0?s:mt(r)||Ar(r)?r.value:nt(r)?r.values[r.values.length-1]:Do(t,hn(n,e-1,r.startTime,s),r)},Wi=(n,e,t,s,r)=>t===void 0?[s.insertTime,r]:mt(t)?[t.endTime,t.value]:Ar(t)?[t.startTime,t.value]:nt(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,hn(n,e-1,t.startTime,r)],ur=n=>n.type==="cancelAndHold",hr=n=>n.type==="cancelScheduledValues",ht=n=>ur(n)||hr(n)?n.cancelTime:Yt(n)||un(n)?n.endTime:n.startTime,zi=(n,e,t,{endTime:s,value:r})=>t===r?r:0<t&&0<r||t<0&&r<0?t*(r/t)**((n-e)/(s-e)):0,Gi=(n,e,t,{endTime:s,value:r})=>t+(n-e)/(s-e)*(r-t),Xl=(n,e)=>{const t=Math.floor(e),s=Math.ceil(e);return t===s?n[t]:(1-(e-t))*n[t]+(1-(s-e))*n[s]},Yl=(n,{duration:e,startTime:t,values:s})=>{const r=(n-t)/e*(s.length-1);return Xl(s,r)},sn=n=>n.type==="setTarget";class Kl{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=ht(e);if(ur(e)||hr(e)){const s=this._automationEvents.findIndex(i=>hr(e)&&nt(i)?i.startTime+i.duration>=t:ht(i)>=t),r=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),ur(e)){const i=this._automationEvents[this._automationEvents.length-1];if(r!==void 0&&mt(r)){if(i!==void 0&&sn(i))throw new Error("The internal list is malformed.");const o=i===void 0?r.insertTime:nt(i)?i.startTime+i.duration:ht(i),a=i===void 0?this._defaultValue:nt(i)?i.values[i.values.length-1]:i.value,c=Yt(r)?zi(t,o,a,r):Gi(t,o,a,r),l=Yt(r)?Ui(c,t,this._currenTime):Bi(c,t,this._currenTime);this._automationEvents.push(l)}if(i!==void 0&&sn(i)&&this._automationEvents.push(lr(this.getValue(t),t)),i!==void 0&&nt(i)&&i.startTime+i.duration>t){const o=t-i.startTime,a=(i.values.length-1)/i.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=i.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=i.values[h-1]*(1-d)+i.values[h]*d}this._automationEvents[this._automationEvents.length-1]=Ro(u,i.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>ht(o)>t),r=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(r!==void 0&&nt(r)&&ht(r)+r.duration>t)return!1;const i=Yt(e)?Ui(e.value,e.endTime,this._currenTime):un(e)?Bi(e.value,t,this._currenTime):e;if(s===-1)this._automationEvents.push(i);else{if(nt(e)&&t+e.duration>ht(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,i)}}return!0}flush(e){const t=this._automationEvents.findIndex(s=>ht(s)>e);if(t>1){const s=this._automationEvents.slice(t-1),r=s[0];sn(r)&&s.unshift(lr(hn(this._automationEvents,t-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=s}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>ht(o)>e),s=this._automationEvents[t],r=(t===-1?this._automationEvents.length:t)-1,i=this._automationEvents[r];if(i!==void 0&&sn(i)&&(s===void 0||!mt(s)||s.insertTime>e))return Do(e,hn(this._automationEvents,r-1,i.startTime,this._defaultValue),i);if(i!==void 0&&Ar(i)&&(s===void 0||!mt(s)))return i.value;if(i!==void 0&&nt(i)&&(s===void 0||!mt(s)||i.startTime+i.duration>e))return e<i.startTime+i.duration?Yl(e,i):i.values[i.values.length-1];if(i!==void 0&&mt(i)&&(s===void 0||!mt(s)))return i.value;if(s!==void 0&&Yt(s)){const[o,a]=Wi(this._automationEvents,r,i,s,this._defaultValue);return zi(e,o,a,s)}if(s!==void 0&&un(s)){const[o,a]=Wi(this._automationEvents,r,i,s,this._defaultValue);return Gi(e,o,a,s)}return this._defaultValue}}const Ql=n=>({cancelTime:n,type:"cancelAndHold"}),eu=n=>({cancelTime:n,type:"cancelScheduledValues"}),tu=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),su=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),nu=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),ru=()=>new DOMException("","AbortError"),iu=n=>(e,t,[s,r,i],o)=>{n(e[r],[t,s,i],a=>a[0]===t&&a[1]===s,o)},ou=n=>(e,t,s)=>{const r=[];for(let i=0;i<s.numberOfInputs;i+=1)r.push(new Set);n.set(e,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},au=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},as=new WeakSet,Po=new WeakMap,xr=new WeakMap,Mo=new WeakMap,Or=new WeakMap,An=new WeakMap,jo=new WeakMap,dr=new WeakMap,fr=new WeakMap,pr=new WeakMap,Fo={construct(){return Fo}},cu=n=>{try{const e=new Proxy(n,Fo);new e}catch{return!1}return!0},Hi=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Ji=(n,e)=>{const t=[];let s=n.replace(/^[\s]+/,""),r=s.match(Hi);for(;r!==null;){const i=r[1].slice(1,-1),o=r[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,e).toString());t.push(o),s=s.slice(r[0].length).replace(/^[\s]+/,""),r=s.match(Hi)}return[t.join(";"),s]},Zi=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Xi=n=>{if(!cu(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},lu=(n,e,t,s,r,i,o,a,c,l,u,h,d)=>{let f=0;return(p,m,_={credentials:"omit"})=>{const y=u.get(p);if(y!==void 0&&y.has(m))return Promise.resolve();const T=l.get(p);if(T!==void 0){const g=T.get(m);if(g!==void 0)return g}const k=i(p),S=k.audioWorklet===void 0?r(m).then(([g,w])=>{const[b,v]=Ji(g,w),O=`${b};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${v}
})})(window,'_AWGS')`;return t(O)}).then(()=>{const g=d._AWGS.pop();if(g===void 0)throw new SyntaxError;s(k.currentTime,k.sampleRate,()=>g(class{},void 0,(w,b)=>{if(w.trim()==="")throw e();const v=fr.get(k);if(v!==void 0){if(v.has(w))throw e();Xi(b),Zi(b.parameterDescriptors),v.set(w,b)}else Xi(b),Zi(b.parameterDescriptors),fr.set(k,new Map([[w,b]]))},k.sampleRate,void 0,void 0))}):Promise.all([r(m),Promise.resolve(n(h,h))]).then(([[g,w],b])=>{const v=f+1;f=v;const[O,x]=Ji(g,w),I=`${O};((AudioWorkletProcessor,registerProcessor)=>{${x}
})(${b?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${b?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${b?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${v}',class extends AudioWorkletProcessor{process(){return !1}})`,j=new Blob([I],{type:"application/javascript; charset=utf-8"}),R=URL.createObjectURL(j);return k.audioWorklet.addModule(R,_).then(()=>{if(a(k))return k;const D=o(k);return D.audioWorklet.addModule(R,_).then(()=>D)}).then(D=>{if(c===null)throw new SyntaxError;try{new c(D,`__sac${v}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(R))});return T===void 0?l.set(p,new Map([[m,S]])):T.set(m,S),S.then(()=>{const g=u.get(p);g===void 0?u.set(p,new Set([m])):g.add(m)}).finally(()=>{const g=l.get(p);g!==void 0&&g.delete(m)}),S}},We=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},xn=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[s]=t;return n.delete(s),s},Vo=(n,e,t,s)=>{const r=We(n,e),i=xn(r,o=>o[0]===t&&o[1]===s);return r.size===0&&n.delete(e),i},Fs=n=>We(jo,n),cs=n=>{if(as.has(n))throw new Error("The AudioNode is already stored.");as.add(n),Fs(n).forEach(e=>e(!0))},Lo=n=>"port"in n,Vs=n=>{if(!as.has(n))throw new Error("The AudioNode is not stored.");as.delete(n),Fs(n).forEach(e=>e(!1))},mr=(n,e)=>{!Lo(n)&&e.every(t=>t.size===0)&&Vs(n)},uu=(n,e,t,s,r,i,o,a,c,l,u,h,d)=>{const f=new WeakMap;return(p,m,_,y,T)=>{const{activeInputs:k,passiveInputs:S}=i(m),{outputs:g}=i(p),w=a(p),b=v=>{const O=c(m),x=c(p);if(v){const A=Vo(S,p,_,y);n(k,p,A,!1),!T&&!h(p)&&t(x,O,_,y),d(m)&&cs(m)}else{const A=s(k,p,_,y);e(S,y,A,!1),!T&&!h(p)&&r(x,O,_,y);const C=o(m);if(C===0)u(m)&&mr(m,k);else{const N=f.get(m);N!==void 0&&clearTimeout(N),f.set(m,setTimeout(()=>{u(m)&&mr(m,k)},C*1e3))}}};return l(g,[m,_,y],v=>v[0]===m&&v[1]===_&&v[2]===y,!0)?(w.add(b),u(p)?n(k,p,[_,y,b],!0):e(S,y,[p,_,b],!0),!0):!1}},hu=n=>(e,t,[s,r,i],o)=>{const a=e.get(s);a===void 0?e.set(s,new Set([[r,t,i]])):n(a,[r,t,i],c=>c[0]===r&&c[1]===t,o)},du=n=>(e,t)=>{const s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(s).connect(e.destination);const r=()=>{t.removeEventListener("ended",r),t.disconnect(s),s.disconnect()};t.addEventListener("ended",r)},fu=n=>(e,t)=>{n(e).add(t)},pu={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},mu=(n,e,t,s,r,i)=>class extends n{constructor(a,c){const l=r(a),u={...pu,...c},h=s(l,u),d=i(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},be=(n,e)=>n.context===e,_u=(n,e,t)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=e(i);if(!be(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return s.set(o,a),await t(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},dn=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Ke=()=>new DOMException("","IndexSizeError"),Er=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(s){throw s.code===12?Ke():s}})(n.getChannelData)},gu={numberOfChannels:1},yu=(n,e,t,s,r,i,o,a)=>{let c=null;return class $o{constructor(u){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...gu,...u};c===null&&(c=new r(1,1,44100));const p=s!==null&&e(i,i)?new s({length:h,numberOfChannels:d,sampleRate:f}):c.createBuffer(d,h,f);if(p.numberOfChannels===0)throw t();return typeof p.copyFromChannel!="function"?(o(p),Er(p)):e(dn,()=>dn(p))||a(p),n.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===$o.prototype||n.has(u)}}},Pe=-34028234663852886e22,ke=34028234663852886e22,rt=n=>as.has(n),vu={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},wu=(n,e,t,s,r,i,o,a)=>class extends n{constructor(l,u){const h=i(l),d={...vu,...u},f=r(h,d),p=o(h),m=p?e():null;super(l,!1,f,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=t(this,p,f.playbackRate,ke,Pe)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){cs(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),rt(this)&&Vs(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},bu=(n,e,t,s,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=be(h,u);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,f),o!==null&&h.start(...o),a!==null&&h.stop(a)}return i.set(u,h),d?await n(u,l.playbackRate,h.playbackRate):await s(u,l.playbackRate,h.playbackRate),await r(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=i.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Tu=n=>"playbackRate"in n,ku=n=>"frequency"in n&&"gain"in n,Su=n=>"offset"in n,Cu=n=>!("frequency"in n)&&"gain"in n,Au=n=>"detune"in n&&"frequency"in n&&!("gain"in n),xu=n=>"pan"in n,Se=n=>We(Po,n),Ls=n=>We(Mo,n),_r=(n,e)=>{const{activeInputs:t}=Se(n);t.forEach(r=>r.forEach(([i])=>{e.includes(n)||_r(i,[...e,n])}));const s=Tu(n)?[n.playbackRate]:Lo(n)?Array.from(n.parameters.values()):ku(n)?[n.Q,n.detune,n.frequency,n.gain]:Su(n)?[n.offset]:Cu(n)?[n.gain]:Au(n)?[n.detune,n.frequency]:xu(n)?[n.pan]:[];for(const r of s){const i=Ls(r);i!==void 0&&i.activeInputs.forEach(([o])=>_r(o,e))}rt(n)&&Vs(n)},qo=n=>{_r(n.destination,[])},Ou=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),Eu=(n,e,t,s,r,i,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?t():p}if(h===null)throw s();if(!Ou(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),qo(this)}))}createMediaElementSource(u){return new r(this,{mediaElement:u})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},Iu=(n,e,t,s,r,i,o,a)=>class extends n{constructor(l,u){const h=i(l),d=o(h),f=r(h,u,d),p=d?e(a):null;super(l,!1,f,p),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Nu=n=>{const e=new WeakMap,t=async(s,r)=>{const i=r.destination;return e.set(r,i),await n(s,r,i),i};return{render(s,r){const i=e.get(r);return i!==void 0?Promise.resolve(i):t(s,r)}}},Ru=(n,e,t,s,r,i,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const g=new Float32Array(1),w=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),b=o(l);let v=!1,O=[0,0,-1,0,1,0],x=[0,0,0];const A=()=>{if(v)return;v=!0;const j=s(l,256,9,0);j.onaudioprocess=({inputBuffer:R})=>{const D=[i(R,g,0),i(R,g,1),i(R,g,2),i(R,g,3),i(R,g,4),i(R,g,5)];D.some((F,q)=>F!==O[q])&&(u.setOrientation(...D),O=D);const W=[i(R,g,6),i(R,g,7),i(R,g,8)];W.some((F,q)=>F!==x[q])&&(u.setPosition(...W),x=W)},w.connect(j)},C=j=>R=>{R!==O[j]&&(O[j]=R,u.setOrientation(...O))},N=j=>R=>{R!==x[j]&&(x[j]=R,u.setPosition(...x))},I=(j,R,D)=>{const W=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:R});W.connect(w,0,j),W.start(),Object.defineProperty(W.offset,"defaultValue",{get(){return R}});const F=n({context:c},b,W.offset,ke,Pe);return a(F,"value",q=>()=>q.call(F),q=>$=>{try{q.call(F,$)}catch(ee){if(ee.code!==9)throw ee}A(),b&&D($)}),F.cancelAndHoldAtTime=(q=>b?()=>{throw r()}:(...$)=>{const ee=q.apply(F,$);return A(),ee})(F.cancelAndHoldAtTime),F.cancelScheduledValues=(q=>b?()=>{throw r()}:(...$)=>{const ee=q.apply(F,$);return A(),ee})(F.cancelScheduledValues),F.exponentialRampToValueAtTime=(q=>b?()=>{throw r()}:(...$)=>{const ee=q.apply(F,$);return A(),ee})(F.exponentialRampToValueAtTime),F.linearRampToValueAtTime=(q=>b?()=>{throw r()}:(...$)=>{const ee=q.apply(F,$);return A(),ee})(F.linearRampToValueAtTime),F.setTargetAtTime=(q=>b?()=>{throw r()}:(...$)=>{const ee=q.apply(F,$);return A(),ee})(F.setTargetAtTime),F.setValueAtTime=(q=>b?()=>{throw r()}:(...$)=>{const ee=q.apply(F,$);return A(),ee})(F.setValueAtTime),F.setValueCurveAtTime=(q=>b?()=>{throw r()}:(...$)=>{const ee=q.apply(F,$);return A(),ee})(F.setValueCurveAtTime),F};return{forwardX:I(0,0,C(0)),forwardY:I(1,0,C(1)),forwardZ:I(2,-1,C(2)),positionX:I(6,0,N(0)),positionY:I(7,0,N(1)),positionZ:I(8,0,N(2)),upX:I(3,0,C(3)),upY:I(4,1,C(4)),upZ:I(5,0,C(5))}},{forwardX:d,forwardY:f,forwardZ:p,positionX:m,positionY:_,positionZ:y,upX:T,upY:k,upZ:S}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return p},get positionX(){return m},get positionY(){return _},get positionZ(){return y},get upX(){return T},get upY(){return k},get upZ(){return S}}},fn=n=>"context"in n,$s=n=>fn(n[0]),Mt=(n,e,t,s)=>{for(const r of n)if(t(r)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},Yi=(n,e,[t,s],r)=>{Mt(n,[e,t,s],i=>i[0]===e&&i[1]===t,r)},Ki=(n,[e,t,s],r)=>{const i=n.get(e);i===void 0?n.set(e,new Set([[t,s]])):Mt(i,[t,s],o=>o[0]===t,r)},ms=n=>"inputs"in n,pn=(n,e,t,s)=>{if(ms(e)){const r=e.inputs[s];return n.connect(r,t,0),[r,t,0]}return n.connect(e,t,s),[e,t,s]},Uo=(n,e,t)=>{for(const s of n)if(s[0]===e&&s[1]===t)return n.delete(s),s;return null},Du=(n,e,t)=>xn(n,s=>s[0]===e&&s[1]===t),Bo=(n,e)=>{if(!Fs(n).delete(e))throw new Error("Missing the expected event listener.")},Wo=(n,e,t)=>{const s=We(n,e),r=xn(s,i=>i[0]===t);return s.size===0&&n.delete(e),r},mn=(n,e,t,s)=>{ms(e)?n.disconnect(e.inputs[s],t,0):n.disconnect(e,t,s)},re=n=>We(xr,n),Rs=n=>We(Or,n),It=n=>dr.has(n),an=n=>!as.has(n),Qi=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const s=n.createScriptProcessor(256,1,1),r=n.createGain(),i=n.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=i,a.loop=!0,a.connect(s).connect(n.destination),a.connect(r),a.disconnect(r),s.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),s.onaudioprocess=null,a.disconnect(s),s.disconnect(n.destination)},a.start()}}),Kn=(n,e)=>{const t=new Map;for(const s of n)for(const r of s){const i=t.get(r);t.set(r,i===void 0?1:i+1)}t.forEach((s,r)=>e(r,s))},_n=n=>"context"in n,Pu=n=>{const e=new Map;n.connect=(t=>(s,r=0,i=0)=>{const o=_n(s)?t(s,r,i):t(s,r),a=e.get(s);return a===void 0?e.set(s,[{input:i,output:r}]):a.every(c=>c.input!==i||c.output!==r)&&a.push({input:i,output:r}),o})(n.connect.bind(n)),n.disconnect=(t=>(s,r,i)=>{if(t.apply(n),s===void 0)e.clear();else if(typeof s=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==s);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(s))if(r===void 0)e.delete(s);else{const o=e.get(s);if(o!==void 0){const a=o.filter(c=>c.output!==r&&(c.input!==i||i===void 0));a.length===0?e.delete(s):e.set(s,a)}}for(const[o,a]of e)a.forEach(c=>{_n(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},Mu=(n,e,t,s)=>{const{activeInputs:r,passiveInputs:i}=Ls(e),{outputs:o}=Se(n),a=Fs(n),c=l=>{const u=re(n),h=Rs(e);if(l){const d=Wo(i,n,t);Yi(r,n,d,!1),!s&&!It(n)&&u.connect(h,t)}else{const d=Du(r,n,t);Ki(i,d,!1),!s&&!It(n)&&u.disconnect(h,t)}};return Mt(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),rt(n)?Yi(r,n,[t,c],!0):Ki(i,[n,t,c],!0),!0):!1},ju=(n,e,t,s)=>{const{activeInputs:r,passiveInputs:i}=Se(e),o=Uo(r[s],n,t);return o===null?[Vo(i,n,t,s)[2],!1]:[o[2],!0]},Fu=(n,e,t)=>{const{activeInputs:s,passiveInputs:r}=Ls(e),i=Uo(s,n,t);return i===null?[Wo(r,n,t)[1],!1]:[i[2],!0]},Ir=(n,e,t,s,r)=>{const[i,o]=ju(n,t,s,r);if(i!==null&&(Bo(n,i),o&&!e&&!It(n)&&mn(re(n),re(t),s,r)),rt(t)){const{activeInputs:a}=Se(t);mr(t,a)}},Nr=(n,e,t,s)=>{const[r,i]=Fu(n,t,s);r!==null&&(Bo(n,r),i&&!e&&!It(n)&&re(n).disconnect(Rs(t),s))},Vu=(n,e)=>{const t=Se(n),s=[];for(const r of t.outputs)$s(r)?Ir(n,e,...r):Nr(n,e,...r),s.push(r[0]);return t.outputs.clear(),s},Lu=(n,e,t)=>{const s=Se(n),r=[];for(const i of s.outputs)i[1]===t&&($s(i)?Ir(n,e,...i):Nr(n,e,...i),r.push(i[0]),s.outputs.delete(i));return r},$u=(n,e,t,s,r)=>{const i=Se(n);return Array.from(i.outputs).filter(o=>o[0]===t&&(s===void 0||o[1]===s)&&(r===void 0||o[2]===r)).map(o=>($s(o)?Ir(n,e,...o):Nr(n,e,...o),i.outputs.delete(o),o[0]))},qu=(n,e,t,s,r,i,o,a,c,l,u,h,d,f,p,m)=>class extends l{constructor(y,T,k,S){super(k),this._context=y,this._nativeAudioNode=k;const g=u(y);h(g)&&t(Qi,()=>Qi(g,m))!==!0&&Pu(k),xr.set(this,k),jo.set(this,new Set),y.state!=="closed"&&T&&cs(this),n(this,S,k)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,T=0,k=0){if(T<0||T>=this._nativeAudioNode.numberOfOutputs)throw r();const S=u(this._context),g=p(S);if(d(y)||f(y))throw i();if(fn(y)){const v=re(y);try{const x=pn(this._nativeAudioNode,v,T,k),A=an(this);(g||A)&&this._nativeAudioNode.disconnect(...x),this.context.state!=="closed"&&!A&&an(y)&&cs(y)}catch(x){throw x.code===12?i():x}if(e(this,y,T,k,g)){const x=c([this],y);Kn(x,s(g))}return y}const w=Rs(y);if(w.name==="playbackRate"&&w.maxValue===1024)throw o();try{this._nativeAudioNode.connect(w,T),(g||an(this))&&this._nativeAudioNode.disconnect(w,T)}catch(v){throw v.code===12?i():v}if(Mu(this,y,T,g)){const v=c([this],y);Kn(v,s(g))}}disconnect(y,T,k){let S;const g=u(this._context),w=p(g);if(y===void 0)S=Vu(this,w);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw r();S=Lu(this,w,y)}else{if(T!==void 0&&(T<0||T>=this.numberOfOutputs)||fn(y)&&k!==void 0&&(k<0||k>=y.numberOfInputs))throw r();if(S=$u(this,w,y,T,k),S.length===0)throw i()}for(const b of S){const v=c([this],b);Kn(v,a)}}},Uu=(n,e,t,s,r,i,o,a,c,l,u,h,d)=>(f,p,m,_=null,y=null)=>{const T=m.value,k=new Kl(T),S=p?s(k):null,g={get defaultValue(){return T},get maxValue(){return _===null?m.maxValue:_},get minValue(){return y===null?m.minValue:y},get value(){return m.value},set value(w){m.value=w,g.setValueAtTime(w,f.context.currentTime)},cancelAndHoldAtTime(w){if(typeof m.cancelAndHoldAtTime=="function")S===null&&k.flush(f.context.currentTime),k.add(r(w)),m.cancelAndHoldAtTime(w);else{const b=Array.from(k).pop();S===null&&k.flush(f.context.currentTime),k.add(r(w));const v=Array.from(k).pop();m.cancelScheduledValues(w),b!==v&&v!==void 0&&(v.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(v.value,v.endTime):v.type==="linearRampToValue"?m.linearRampToValueAtTime(v.value,v.endTime):v.type==="setValue"?m.setValueAtTime(v.value,v.startTime):v.type==="setValueCurve"&&m.setValueCurveAtTime(v.values,v.startTime,v.duration))}return g},cancelScheduledValues(w){return S===null&&k.flush(f.context.currentTime),k.add(i(w)),m.cancelScheduledValues(w),g},exponentialRampToValueAtTime(w,b){if(w===0)throw new RangeError;if(!Number.isFinite(b)||b<0)throw new RangeError;const v=f.context.currentTime;return S===null&&k.flush(v),Array.from(k).length===0&&(k.add(l(T,v)),m.setValueAtTime(T,v)),k.add(o(w,b)),m.exponentialRampToValueAtTime(w,b),g},linearRampToValueAtTime(w,b){const v=f.context.currentTime;return S===null&&k.flush(v),Array.from(k).length===0&&(k.add(l(T,v)),m.setValueAtTime(T,v)),k.add(a(w,b)),m.linearRampToValueAtTime(w,b),g},setTargetAtTime(w,b,v){return S===null&&k.flush(f.context.currentTime),k.add(c(w,b,v)),m.setTargetAtTime(w,b,v),g},setValueAtTime(w,b){return S===null&&k.flush(f.context.currentTime),k.add(l(w,b)),m.setValueAtTime(w,b),g},setValueCurveAtTime(w,b,v){const O=w instanceof Float32Array?w:new Float32Array(w);if(h!==null&&h.name==="webkitAudioContext"){const x=b+v,A=f.context.sampleRate,C=Math.ceil(b*A),N=Math.floor(x*A),I=N-C,j=new Float32Array(I);for(let D=0;D<I;D+=1){const W=(O.length-1)/v*((C+D)/A-b),F=Math.floor(W),q=Math.ceil(W);j[D]=F===q?O[F]:(1-(W-F))*O[F]+(1-(q-W))*O[q]}S===null&&k.flush(f.context.currentTime),k.add(u(j,b,v)),m.setValueCurveAtTime(j,b,v);const R=N/A;R<x&&d(g,j[j.length-1],R),d(g,O[O.length-1],x)}else S===null&&k.flush(f.context.currentTime),k.add(u(O,b,v)),m.setValueCurveAtTime(O,b,v);return g}};return t.set(g,m),e.set(g,f),n(g,S),g},Bu=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:s,value:r}=t;e.exponentialRampToValueAtTime(r,s)}else if(t.type==="linearRampToValue"){const{endTime:s,value:r}=t;e.linearRampToValueAtTime(r,s)}else if(t.type==="setTarget"){const{startTime:s,target:r,timeConstant:i}=t;e.setTargetAtTime(r,s,i)}else if(t.type==="setValue"){const{startTime:s,value:r}=t;e.setValueAtTime(r,s)}else if(t.type==="setValueCurve"){const{duration:s,startTime:r,values:i}=t;e.setValueCurveAtTime(i,r,s)}else throw new Error("Can't apply an unknown automation.")}});class zo{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((s,r)=>e.call(t,s,r,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Wu={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},zu=(n,e,t,s,r,i,o,a,c,l,u,h,d,f)=>class extends e{constructor(m,_,y){var T;const k=a(m),S=c(k),g=u({...Wu,...y});d(g);const w=fr.get(k),b=w==null?void 0:w.get(_),v=S||k.state!=="closed"?k:(T=o(k))!==null&&T!==void 0?T:k,O=r(v,S?null:m.baseLatency,l,_,b,g),x=S?s(_,g,b):null;super(m,!0,O,x);const A=[];O.parameters.forEach((N,I)=>{const j=t(this,S,N);A.push([I,j])}),this._nativeAudioWorkletNode=O,this._onprocessorerror=null,this._parameters=new zo(A),S&&n(k,this);const{activeInputs:C}=i(this);h(O,C)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const _=typeof m=="function"?f(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=_;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===_?m:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function gn(n,e,t,s,r){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],s,r);else{const i=n.getChannelData(s);if(e[t].byteLength===0)e[t]=i.slice(r,r+128);else{const o=new Float32Array(i.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const Go=(n,e,t,s,r)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],s,r):e[t].byteLength!==0&&n.getChannelData(s).set(e[t],r)},yn=(n,e)=>{const t=[];for(let s=0;s<n;s+=1){const r=[],i=typeof e=="number"?e:e[s];for(let o=0;o<i;o+=1)r.push(new Float32Array(128));t.push(r)}return t},Gu=(n,e)=>{const t=We(pr,n),s=re(e);return We(t,s)},Hu=async(n,e,t,s,r,i,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=s.channelCount*s.numberOfInputs,l=r.reduce((_,y)=>_+y,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const h=Se(n),d=await Gu(t,n),f=yn(s.numberOfInputs,s.channelCount),p=yn(s.numberOfOutputs,r),m=Array.from(n.parameters.keys()).reduce((_,y)=>({..._,[y]:new Float32Array(128)}),{});for(let _=0;_<a;_+=128){if(s.numberOfInputs>0&&e!==null)for(let y=0;y<s.numberOfInputs;y+=1)for(let T=0;T<s.channelCount;T+=1)gn(e,f[y],T,T,_);i.parameterDescriptors!==void 0&&e!==null&&i.parameterDescriptors.forEach(({name:y},T)=>{gn(e,m,y,c+T,_)});for(let y=0;y<s.numberOfInputs;y+=1)for(let T=0;T<r[y];T+=1)p[y][T].byteLength===0&&(p[y][T]=new Float32Array(128));try{const y=f.map((k,S)=>h.activeInputs[S].size===0?[]:k),T=o(_/t.sampleRate,t.sampleRate,()=>d.process(y,p,m));if(u!==null)for(let k=0,S=0;k<s.numberOfOutputs;k+=1){for(let g=0;g<r[k];g+=1)Go(u,p[k],g,S+g,_);S+=r[k]}if(!T)break}catch(y){n.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},Ju=(n,e,t,s,r,i,o,a,c,l,u,h,d,f,p,m)=>(_,y,T)=>{const k=new WeakMap;let S=null;const g=async(w,b)=>{let v=u(w),O=null;const x=be(v,b),A=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){const C=A.reduce((R,D)=>R+D,0),N=r(b,{channelCount:Math.max(1,C),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,C)}),I=[];for(let R=0;R<w.numberOfOutputs;R+=1)I.push(s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:A[R]}));const j=o(b,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});j.connect=e.bind(null,I),j.disconnect=c.bind(null,I),O=[N,I,j]}else x||(v=new h(b,_));if(k.set(b,O===null?v:O[2]),O!==null){if(S===null){if(T===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const D=w.channelCount*w.numberOfInputs,W=T.parameterDescriptors===void 0?0:T.parameterDescriptors.length,F=D+W;S=Hu(w,F===0?null:await(async()=>{const $=new d(F,Math.ceil(w.context.length/128)*128,b.sampleRate),ee=[],Ne=[];for(let ie=0;ie<y.numberOfInputs;ie+=1)ee.push(o($,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),Ne.push(r($,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const Re=await Promise.all(Array.from(w.parameters.values()).map(async ie=>{const Te=i($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ie.value});return await f($,ie,Te.offset),Te})),z=s($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,D+W)});for(let ie=0;ie<y.numberOfInputs;ie+=1){ee[ie].connect(Ne[ie]);for(let Te=0;Te<y.channelCount;Te+=1)Ne[ie].connect(z,Te,ie*y.channelCount+Te)}for(const[ie,Te]of Re.entries())Te.connect(z,0,D+ie),Te.start(0);return z.connect($.destination),await Promise.all(ee.map(ie=>p(w,$,ie))),m($)})(),b,y,A,T,l)}const C=await S,N=t(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[I,j,R]=O;C!==null&&(N.buffer=C,N.start(0)),N.connect(I);for(let D=0,W=0;D<w.numberOfOutputs;D+=1){const F=j[D];for(let q=0;q<A[D];q+=1)I.connect(F,W+q,q);W+=A[D]}return R}if(x)for(const[C,N]of w.parameters.entries())await n(b,N,v.parameters.get(C));else for(const[C,N]of w.parameters.entries())await f(b,N,v.parameters.get(C));return await p(w,b,v),v};return{render(w,b){a(b,w);const v=k.get(b);return v!==void 0?Promise.resolve(v):g(w,b)}}},Zu=(n,e,t,s,r,i,o,a,c,l,u,h,d,f,p,m,_,y,T,k)=>class extends p{constructor(g,w){super(g,w),this._nativeContext=g,this._audioWorklet=n===void 0?void 0:{addModule:(b,v)=>n(this,b,v)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new r(this)}createBuffer(g,w,b){return new t({length:w,numberOfChannels:g,sampleRate:b})}createBufferSource(){return new s(this)}createChannelMerger(g=6){return new i(this,{numberOfInputs:g})}createChannelSplitter(g=6){return new o(this,{numberOfOutputs:g})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(g=1){return new u(this,{maxDelayTime:g})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(g,w){return new f(this,{feedback:w,feedforward:g})}createOscillator(){return new m(this)}createPanner(){return new _(this)}createPeriodicWave(g,w,b={disableNormalization:!1}){return new y(this,{...b,imag:w,real:g})}createStereoPanner(){return new T(this)}createWaveShaper(){return new k(this)}decodeAudioData(g,w,b){return l(this._nativeContext,g).then(v=>(typeof w=="function"&&w(v),v),v=>{throw typeof b=="function"&&b(v),v})}},Xu={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Yu=(n,e,t,s,r,i,o,a)=>class extends n{constructor(l,u){const h=i(l),d={...Xu,...u},f=r(h,d),p=o(h),m=p?t():null;super(l,!1,f,m),this._Q=e(this,p,f.Q,ke,Pe),this._detune=e(this,p,f.detune,1200*Math.log2(ke),-1200*Math.log2(ke)),this._frequency=e(this,p,f.frequency,l.sampleRate/2,0),this._gain=e(this,p,f.gain,40*Math.log10(ke),Pe),this._nativeBiquadFilterNode=f,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?s():d}if(l.length!==u.length||u.length!==h.length)throw s()}},Ku=(n,e,t,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=be(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return i.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Qu=(n,e)=>(t,s)=>{const r=e.get(t);if(r!==void 0)return r;const i=n.get(t);if(i!==void 0)return i;try{const o=s();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},eh={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},th=(n,e,t,s,r)=>class extends n{constructor(o,a){const c=s(o),l={...eh,...a},u=t(c,l),h=r(c)?e():null;super(o,!1,u,h)}},sh=(n,e,t)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=e(i);if(!be(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return s.set(o,a),await t(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},nh={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},rh=(n,e,t,s,r,i)=>class extends n{constructor(a,c){const l=s(a),u=i({...nh,...c}),h=t(l,u),d=r(l)?e():null;super(a,!1,h,d)}},ih=(n,e,t)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=e(i);if(!be(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return s.set(o,a),await t(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},oh=n=>(e,t,s)=>n(t,e,s),ah=n=>(e,t,s=0,r=0)=>{const i=e[s];if(i===void 0)throw n();return _n(t)?i.connect(t,0,r):i.connect(t,0)},ch=n=>(e,t)=>{const s=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=e.createBuffer(1,2,44100);return s.buffer=r,s.loop=!0,s.connect(t),s.start(),()=>{s.stop(),s.disconnect(t)}},lh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},uh=(n,e,t,s,r,i,o)=>class extends n{constructor(c,l){const u=r(c),h={...lh,...l},d=s(u,h),f=i(u),p=f?t():null;super(c,!1,d,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,ke,Pe),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){cs(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),rt(this)&&Vs(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},hh=(n,e,t,s,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=be(h,u);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,f),o!==null&&h.start(o),a!==null&&h.stop(a)}return i.set(u,h),d?await n(u,l.offset,h.offset):await s(u,l.offset,h.offset),await r(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=i.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},dh=n=>e=>(n[0]=e,n[0]),fh={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},ph=(n,e,t,s,r,i)=>class extends n{constructor(a,c){const l=s(a),u={...fh,...c},h=t(l,u),f=r(l)?e():null;super(a,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&i(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},mh=(n,e,t)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=e(i);if(!be(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return s.set(o,a),ms(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},_h=(n,e)=>(t,s,r)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,s,r)}catch(i){throw i.name==="SyntaxError"?n():i}},gh=()=>new DOMException("","DataCloneError"),eo=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(s=>{const r=()=>{t.onmessage=null,e.close(),t.close(),s()};t.onmessage=()=>r();try{e.postMessage(n,[n])}catch{}finally{r()}})},yh=(n,e,t,s,r,i,o,a,c,l,u)=>(h,d)=>{const f=o(h)?h:i(h);if(r.has(d)){const p=t();return Promise.reject(p)}try{r.add(d)}catch{}return e(c,()=>c(f))?f.decodeAudioData(d).then(p=>(eo(d).catch(()=>{}),e(a,()=>a(p))||u(p),n.add(p),p)):new Promise((p,m)=>{const _=async()=>{try{await eo(d)}catch{}},y=T=>{m(T),_()};try{f.decodeAudioData(d,T=>{typeof T.copyFromChannel!="function"&&(l(T),Er(T)),n.add(T),_().then(()=>p(T))},T=>{y(T===null?s():T)})}catch(T){y(T)}})},vh=(n,e,t,s,r,i,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=i(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const f=s(c),{outputs:p}=t(c);for(const m of p)if($s(m)){const _=s(m[0]);n(f,_,m[1],m[2])}else{const _=r(m[0]);f.connect(_,m[1])}}}else e.set(c,u-l)},wh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},bh=(n,e,t,s,r,i,o)=>class extends n{constructor(c,l){const u=r(c),h={...wh,...l},d=s(u,h),f=i(u),p=f?t(h.maxDelayTime):null;super(c,!1,d,p),this._delayTime=e(this,f,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},Th=(n,e,t,s,r)=>i=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=be(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:i};u=e(l,d)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await s(l,c.delayTime,u.delayTime),await r(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},kh=n=>(e,t,s,r)=>n(e[r],i=>i[0]===t&&i[1]===s),Sh=n=>(e,t)=>{n(e).delete(t)},Ch=n=>"delayTime"in n,Ah=(n,e,t)=>function s(r,i){const o=fn(i)?i:t(n,i);if(Ch(o))return[];if(r[0]===o)return[r];if(r.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>s([...r,o],c[0])).reduce((c,l)=>c.concat(l),[])},nn=(n,e,t)=>{const s=e[t];if(s===void 0)throw n();return s},xh=n=>(e,t=void 0,s=void 0,r=0)=>t===void 0?e.forEach(i=>i.disconnect()):typeof t=="number"?nn(n,e,t).disconnect():_n(t)?s===void 0?e.forEach(i=>i.disconnect(t)):r===void 0?nn(n,e,s).disconnect(t,0):nn(n,e,s).disconnect(t,0,r):s===void 0?e.forEach(i=>i.disconnect(t)):nn(n,e,s).disconnect(t,0),Oh={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Eh=(n,e,t,s,r,i,o,a)=>class extends n{constructor(l,u){const h=i(l),d={...Oh,...u},f=s(h,d),p=o(h),m=p?t():null;super(l,!1,f,m),this._attack=e(this,p,f.attack),this._knee=e(this,p,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,p,f.ratio),this._release=e(this,p,f.release),this._threshold=e(this,p,f.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,r()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,r()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Ih=(n,e,t,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=be(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return i.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Nh=()=>new DOMException("","EncodingError"),Rh=n=>e=>new Promise((t,s)=>{if(n===null){s(new SyntaxError);return}const r=n.document.head;if(r===null)s(new SyntaxError);else{const i=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,d,f,p)=>{if(h===a||h===n.location.href&&d===1&&f===1)return l(),s(p),!1;if(c!==null)return c(u,h,d,f,p)},i.onerror=()=>{l(),s(new SyntaxError)},i.onload=()=>{l(),t()},i.src=a,i.type="module",r.appendChild(i)}}),Dh=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,s,r){if(s!==null){let i=this._listeners.get(s);i===void 0&&(i=n(this,s),typeof s=="function"&&this._listeners.set(s,i)),this._nativeEventTarget.addEventListener(t,i,r)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,s,r){const i=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(t,i===void 0?null:i,r)}},Ph=n=>(e,t,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},Mh=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},jh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Fh=(n,e,t,s,r,i)=>class extends n{constructor(a,c){const l=r(a),u={...jh,...c},h=s(l,u),d=i(l),f=d?t():null;super(a,!1,h,f),this._gain=e(this,d,h.gain,ke,Pe)}get gain(){return this._gain}},Vh=(n,e,t,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=be(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return i.set(c,l),u?await n(c,a.gain,l.gain):await s(c,a.gain,l.gain),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Lh=(n,e)=>t=>e(n,t),$h=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},qh=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},Uh=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},Bh=n=>e=>n.get(e),ve=()=>new DOMException("","InvalidStateError"),Wh=n=>e=>{const t=n.get(e);if(t===void 0)throw ve();return t},zh=(n,e)=>t=>{let s=n.get(t);if(s!==void 0)return s;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),n.set(t,s),s},Gh=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},On=()=>new DOMException("","InvalidAccessError"),Hh=n=>{n.getFrequencyResponse=(e=>(t,s,r)=>{if(t.length!==s.length||s.length!==r.length)throw On();return e.call(n,t,s,r)})(n.getFrequencyResponse)},Jh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Zh=(n,e,t,s,r,i)=>class extends n{constructor(a,c){const l=s(a),u=r(l),h={...Jh,...c},d=e(l,u?null:a.baseLatency,h),f=u?t(h.feedback,h.feedforward):null;super(a,!1,d,f),Hh(d),this._nativeIIRFilterNode=d,i(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},Ho=(n,e,t,s,r,i,o,a,c,l,u)=>{const h=l.length;let d=a;for(let f=0;f<h;f+=1){let p=t[0]*l[f];for(let m=1;m<r;m+=1){const _=d-m&c-1;p+=t[m]*i[_],p-=n[m]*o[_]}for(let m=r;m<s;m+=1)p+=t[m]*i[d-m&c-1];for(let m=r;m<e;m+=1)p-=n[m]*o[d-m&c-1];i[d]=l[f],o[d]=p,d=d+1&c-1,u[f]=p}return d},Xh=(n,e,t,s)=>{const r=t instanceof Float64Array?t:new Float64Array(t),i=s instanceof Float64Array?s:new Float64Array(s),o=r.length,a=i.length,c=Math.min(o,a);if(r[0]!==1){for(let p=0;p<o;p+=1)i[p]/=r[0];for(let p=1;p<a;p+=1)r[p]/=r[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),f=n.numberOfChannels;for(let p=0;p<f;p+=1){const m=n.getChannelData(p),_=d.getChannelData(p);u.fill(0),h.fill(0),Ho(r,o,i,a,c,u,h,0,l,m,_)}return d},Yh=(n,e,t,s,r)=>(i,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,f=e(u);const p=be(f,h);if(h.createIIRFilter===void 0?d=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(f=h.createIIRFilter(o,i)),a.set(h,d===null?f:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await s(u,_,_.destination);const y=await r(_);return Xh(y,h,i,o)})()}const m=await c;return d.buffer=m,d.start(0),d}return await s(u,h,f),f};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Kh=(n,e,t,s,r,i)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&i(a)){const u=s(a),{outputs:h}=t(a);for(const d of h)if($s(d)){const f=s(d[0]);e(u,f,d[1],d[2])}else{const f=r(d[0]);u.disconnect(f,d[1])}}n.set(a,c)}else n.set(a,l+c)},Qh=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},ed=(n,e)=>t=>n.has(t)||e(t),td=(n,e)=>t=>n.has(t)||e(t),sd=(n,e)=>t=>{const s=n.get(t);return e(s)||e(t)},nd=n=>e=>n!==null&&e instanceof n,rd=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,id=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,od=(n,e)=>t=>n(t)||e(t),ad=n=>e=>n!==null&&e instanceof n,cd=n=>n!==null&&n.isSecureContext,ld=(n,e,t,s)=>class extends n{constructor(i,o){const a=t(i),c=e(a,o);if(s(a))throw TypeError();super(i,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},ud={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},hd=(n,e,t,s)=>class extends n{constructor(i,o){const a=t(i);if(s(a))throw new TypeError;const c={...ud,...o},l=e(a,c);super(i,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},dd=(n,e,t,s)=>class extends n{constructor(i,o){const a=t(i),c=e(a,o);if(s(a))throw new TypeError;super(i,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},fd=(n,e,t)=>class extends n{constructor(r,i){const o=t(r),a=e(o,i);super(r,!0,a,null)}},pd=(n,e,t,s,r,i)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,An.set(this,a),s(a)&&r.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?i(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Ds=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},md=(n,e)=>(t,s,r)=>{const i=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=i.size===0;if(e(a))return o.call(t,a,c,l),n(i,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&s(),a;o.call(t,a,c),n(i,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&s()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=i.size>0;if(a===void 0)o.apply(t),i.clear();else if(typeof a=="number"){o.call(t,a);for(const d of i)d[1]===a&&i.delete(d)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const d of i)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&i.delete(d)}const h=i.size===0;u&&h&&r()})(t.disconnect),t},oe=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t]&&(n[t]=s)},_e=(n,e)=>{oe(n,e,"channelCount"),oe(n,e,"channelCountMode"),oe(n,e,"channelInterpretation")},to=n=>typeof n.getFloatTimeDomainData=="function",_d=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const s=Math.max(t.length,n.fftSize);for(let r=0;r<s;r+=1)e[r]=(t[r]-128)*.0078125;return e}},gd=(n,e)=>(t,s)=>{const r=t.createAnalyser();if(_e(r,s),!(s.maxDecibels>s.minDecibels))throw e();return oe(r,s,"fftSize"),oe(r,s,"maxDecibels"),oe(r,s,"minDecibels"),oe(r,s,"smoothingTimeConstant"),n(to,()=>to(r))||_d(r),r},yd=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,ue=(n,e,t)=>{const s=e[t];s!==void 0&&s!==n[t].value&&(n[t].value=s)},vd=n=>{n.start=(e=>{let t=!1;return(s=0,r=0,i)=>{if(t)throw ve();e.call(n,s,r,i),t=!0}})(n.start)},Rr=n=>{n.start=(e=>(t=0,s=0,r)=>{if(typeof r=="number"&&r<0||s<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,s,r)})(n.start)},Dr=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},wd=(n,e,t,s,r,i,o,a,c,l,u)=>(h,d)=>{const f=h.createBufferSource();return _e(f,d),ue(f,d,"playbackRate"),oe(f,d,"buffer"),oe(f,d,"loop"),oe(f,d,"loopEnd"),oe(f,d,"loopStart"),e(t,()=>t(h))||vd(f),e(s,()=>s(h))||c(f),e(r,()=>r(h))||l(f,h),e(i,()=>i(h))||Rr(f),e(o,()=>o(h))||u(f,h),e(a,()=>a(h))||Dr(f),n(h,f),f},bd=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,Td=(n,e)=>(t,s,r)=>{const i=t.destination;if(i.channelCount!==s)try{i.channelCount=s}catch{}r&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:s});const o=n(t,{channelCount:s,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{i.channelCount=c}catch(l){if(c>i.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},kd=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,Sd=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},Cd=(n,e,t,s,r)=>(i,o,a,c,l,u)=>{if(a!==null)try{const h=new a(i,c,u),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>f,set:p=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof p=="function"?p:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const _=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(_!==null){const y=d.get(m[1]);y!==void 0?m[1]=y:(m[1]=T=>{T.type==="error"?(Object.defineProperties(T,{type:{value:"processorerror"}}),_(T)):_(new ErrorEvent(m[0],{...T}))},d.set(_,m[1]))}}return p.call(h,"error",m[1],m[2]),p.call(h,...m)})(h.addEventListener),h.removeEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const _=d.get(m[1]);_!==void 0&&(d.delete(m[1]),m[1]=_)}return p.call(h,"error",m[1],m[2]),p.call(h,m[0],m[1],m[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(i.destination),r(h,()=>p.disconnect(),()=>p.connect(i.destination))}return h}catch(h){throw h.code===11?s():h}if(l===void 0)throw s();return Sd(u),e(i,o,l,u)},Jo=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),Ad=n=>new Promise((e,t)=>{const{port1:s,port2:r}=new MessageChannel;s.onmessage=({data:i})=>{s.close(),r.close(),e(i)},s.onmessageerror=({data:i})=>{s.close(),r.close(),t(i)},r.postMessage(n)}),xd=async(n,e)=>{const t=await Ad(e);return new n(t)},Od=(n,e,t,s)=>{let r=pr.get(n);r===void 0&&(r=new WeakMap,pr.set(n,r));const i=xd(t,s);return r.set(e,i),i},Ed=(n,e,t,s,r,i,o,a,c,l,u,h,d)=>(f,p,m,_)=>{if(_.numberOfInputs===0&&_.numberOfOutputs===0)throw c();const y=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(y.some(E=>E<1))throw c();if(y.length!==_.numberOfOutputs)throw e();if(_.channelCountMode!=="explicit")throw c();const T=_.channelCount*_.numberOfInputs,k=y.reduce((E,V)=>E+V,0),S=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(T+S>6||k>6)throw c();const g=new MessageChannel,w=[],b=[];for(let E=0;E<_.numberOfInputs;E+=1)w.push(o(f,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),b.push(r(f,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const v=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:E,maxValue:V,minValue:me,name:ce}of m.parameterDescriptors){const J=i(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_.parameterData[ce]!==void 0?_.parameterData[ce]:E===void 0?0:E});Object.defineProperties(J.offset,{defaultValue:{get:()=>E===void 0?0:E},maxValue:{get:()=>V===void 0?ke:V},minValue:{get:()=>me===void 0?Pe:me}}),v.push(J)}const O=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,T+S)}),x=Jo(p,f.sampleRate),A=a(f,x,T+S,Math.max(1,k)),C=r(f,{channelCount:Math.max(1,k),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,k)}),N=[];for(let E=0;E<_.numberOfOutputs;E+=1)N.push(s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[E]}));for(let E=0;E<_.numberOfInputs;E+=1){w[E].connect(b[E]);for(let V=0;V<_.channelCount;V+=1)b[E].connect(O,V,E*_.channelCount+V)}const I=new zo(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:E},V)=>{const me=v[V];return me.connect(O,0,T+V),me.start(0),[E,me.offset]}));O.connect(A);let j=_.channelInterpretation,R=null;const D=_.numberOfOutputs===0?[A]:N,W={get bufferSize(){return x},get channelCount(){return _.channelCount},set channelCount(E){throw t()},get channelCountMode(){return _.channelCountMode},set channelCountMode(E){throw t()},get channelInterpretation(){return j},set channelInterpretation(E){for(const V of w)V.channelInterpretation=E;j=E},get context(){return A.context},get inputs(){return w},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return R},set onprocessorerror(E){typeof R=="function"&&W.removeEventListener("processorerror",R),R=typeof E=="function"?E:null,typeof R=="function"&&W.addEventListener("processorerror",R)},get parameters(){return I},get port(){return g.port2},addEventListener(...E){return A.addEventListener(E[0],E[1],E[2])},connect:n.bind(null,D),disconnect:l.bind(null,D),dispatchEvent(...E){return A.dispatchEvent(E[0])},removeEventListener(...E){return A.removeEventListener(E[0],E[1],E[2])}},F=new Map;g.port1.addEventListener=(E=>(...V)=>{if(V[0]==="message"){const me=typeof V[1]=="function"?V[1]:typeof V[1]=="object"&&V[1]!==null&&typeof V[1].handleEvent=="function"?V[1].handleEvent:null;if(me!==null){const ce=F.get(V[1]);ce!==void 0?V[1]=ce:(V[1]=J=>{u(f.currentTime,f.sampleRate,()=>me(J))},F.set(me,V[1]))}}return E.call(g.port1,V[0],V[1],V[2])})(g.port1.addEventListener),g.port1.removeEventListener=(E=>(...V)=>{if(V[0]==="message"){const me=F.get(V[1]);me!==void 0&&(F.delete(V[1]),V[1]=me)}return E.call(g.port1,V[0],V[1],V[2])})(g.port1.removeEventListener);let q=null;Object.defineProperty(g.port1,"onmessage",{get:()=>q,set:E=>{typeof q=="function"&&g.port1.removeEventListener("message",q),q=typeof E=="function"?E:null,typeof q=="function"&&(g.port1.addEventListener("message",q),g.port1.start())}}),m.prototype.port=g.port1;let $=null;Od(f,W,m,_).then(E=>$=E);const Ne=yn(_.numberOfInputs,_.channelCount),Re=yn(_.numberOfOutputs,y),z=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((E,{name:V})=>({...E,[V]:new Float32Array(128)}),{});let ie=!0;const Te=()=>{_.numberOfOutputs>0&&A.disconnect(C);for(let E=0,V=0;E<_.numberOfOutputs;E+=1){const me=N[E];for(let ce=0;ce<y[E];ce+=1)C.disconnect(me,V+ce,ce);V+=y[E]}},M=new Map;A.onaudioprocess=({inputBuffer:E,outputBuffer:V})=>{if($!==null){const me=h(W);for(let ce=0;ce<x;ce+=128){for(let J=0;J<_.numberOfInputs;J+=1)for(let le=0;le<_.channelCount;le+=1)gn(E,Ne[J],le,le,ce);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:J},le)=>{gn(E,z,J,T+le,ce)});for(let J=0;J<_.numberOfInputs;J+=1)for(let le=0;le<y[J];le+=1)Re[J][le].byteLength===0&&(Re[J][le]=new Float32Array(128));try{const J=Ne.map((je,ut)=>{if(me[ut].size>0)return M.set(ut,x/128),je;const zn=M.get(ut);return zn===void 0?[]:(je.every(Ba=>Ba.every(Wa=>Wa===0))&&(zn===1?M.delete(ut):M.set(ut,zn-1)),je)});ie=u(f.currentTime+ce/f.sampleRate,f.sampleRate,()=>$.process(J,Re,z));for(let je=0,ut=0;je<_.numberOfOutputs;je+=1){for(let Ts=0;Ts<y[je];Ts+=1)Go(V,Re[je],Ts,ut+Ts,ce);ut+=y[je]}}catch(J){ie=!1,W.dispatchEvent(new ErrorEvent("processorerror",{colno:J.colno,filename:J.filename,lineno:J.lineno,message:J.message}))}if(!ie){for(let J=0;J<_.numberOfInputs;J+=1){w[J].disconnect(b[J]);for(let le=0;le<_.channelCount;le+=1)b[ce].disconnect(O,le,J*_.channelCount+le)}if(m.parameterDescriptors!==void 0){const J=m.parameterDescriptors.length;for(let le=0;le<J;le+=1){const je=v[le];je.disconnect(O,0,T+le),je.stop()}}O.disconnect(A),A.onaudioprocess=null,kt?Te():Lt();break}}}};let kt=!1;const St=o(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Vt=()=>A.connect(St).connect(f.destination),Lt=()=>{A.disconnect(St),St.disconnect()},qa=()=>{if(ie){Lt(),_.numberOfOutputs>0&&A.connect(C);for(let E=0,V=0;E<_.numberOfOutputs;E+=1){const me=N[E];for(let ce=0;ce<y[E];ce+=1)C.connect(me,V+ce,ce);V+=y[E]}}kt=!0},Ua=()=>{ie&&(Vt(),Te()),kt=!1};return Vt(),d(W,qa,Ua)},Zo=(n,e)=>{const t=n.createBiquadFilter();return _e(t,e),ue(t,e,"Q"),ue(t,e,"detune"),ue(t,e,"frequency"),ue(t,e,"gain"),oe(t,e,"type"),t},Id=(n,e)=>(t,s)=>{const r=t.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,r),_e(r,s),r},Nd=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw ve()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw ve()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw ve()}})},qs=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return _e(t,e),Nd(t),t},Rd=(n,e,t,s,r)=>(i,o)=>{if(i.createConstantSource===void 0)return t(i,o);const a=i.createConstantSource();return _e(a,o),ue(a,o,"offset"),e(s,()=>s(i))||Rr(a),e(r,()=>r(i))||Dr(a),n(i,a),a},_s=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),Dd=(n,e,t,s)=>(r,{offset:i,...o})=>{const a=r.createBuffer(1,2,44100),c=e(r,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(r,{...o,gain:i}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},d=()=>c.connect(l),f=()=>c.disconnect(l);return n(r,c),s(_s(h,l),d,f)},Pd=(n,e)=>(t,s)=>{const r=t.createConvolver();if(_e(r,s),s.disableNormalization===r.normalize&&(r.normalize=!s.disableNormalization),oe(r,s,"buffer"),s.channelCount>2||(e(r,"channelCount",i=>()=>i.call(r),i=>o=>{if(o>2)throw n();return i.call(r,o)}),s.channelCountMode==="max"))throw n();return e(r,"channelCountMode",i=>()=>i.call(r),i=>o=>{if(o==="max")throw n();return i.call(r,o)}),r},Xo=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return _e(t,e),ue(t,e,"delayTime"),t},Md=n=>(e,t)=>{const s=e.createDynamicsCompressor();if(_e(s,t),t.channelCount>2||t.channelCountMode==="max")throw n();return ue(s,t,"attack"),ue(s,t,"knee"),ue(s,t,"ratio"),ue(s,t,"release"),ue(s,t,"threshold"),s},Ie=(n,e)=>{const t=n.createGain();return _e(t,e),ue(t,e,"gain"),t},jd=n=>(e,t,s)=>{if(e.createIIRFilter===void 0)return n(e,t,s);const r=e.createIIRFilter(s.feedforward,s.feedback);return _e(r,s),r};function Fd(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function Vd(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function so(n,e){let t=[0,0];for(let s=n.length-1;s>=0;s-=1)t=Vd(t,e),t[0]+=n[s];return t}const Ld=(n,e,t,s)=>(r,i,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Jo(i,r.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),p=d.length,m=f.length,_=Math.min(p,m);if(p===0||p>20)throw s();if(d[0]===0)throw e();if(m===0||m>20)throw s();if(f[0]===0)throw e();if(d[0]!==1){for(let v=0;v<m;v+=1)f[v]/=d[0];for(let v=1;v<p;v+=1)d[v]/=d[0]}const y=t(r,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=c;const T=32,k=[],S=[],g=[];for(let v=0;v<o;v+=1){k.push(0);const O=new Float32Array(T),x=new Float32Array(T);O.fill(0),x.fill(0),S.push(O),g.push(x)}y.onaudioprocess=v=>{const O=v.inputBuffer,x=v.outputBuffer,A=O.numberOfChannels;for(let C=0;C<A;C+=1){const N=O.getChannelData(C),I=x.getChannelData(C);k[C]=Ho(d,p,f,m,_,S[C],g[C],k[C],T,N,I)}};const w=r.sampleRate/2;return _s({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(v){y.channelCount=v},get channelCountMode(){return y.channelCountMode},set channelCountMode(v){y.channelCountMode=v},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(v){y.channelInterpretation=v},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...v){return y.addEventListener(v[0],v[1],v[2])},dispatchEvent(...v){return y.dispatchEvent(v[0])},getFrequencyResponse(v,O,x){if(v.length!==O.length||O.length!==x.length)throw n();const A=v.length;for(let C=0;C<A;C+=1){const N=-Math.PI*(v[C]/w),I=[Math.cos(N),Math.sin(N)],j=so(f,I),R=so(d,I),D=Fd(j,R);O[C]=Math.sqrt(D[0]*D[0]+D[1]*D[1]),x[C]=Math.atan2(D[1],D[0])}},removeEventListener(...v){return y.removeEventListener(v[0],v[1],v[2])}},y)},$d=(n,e)=>n.createMediaElementSource(e.mediaElement),qd=(n,e)=>{const t=n.createMediaStreamDestination();return _e(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},Ud=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const s=t.slice(0,1),r=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(r,"mediaStream",{value:e}),r},Bd=(n,e)=>(t,{mediaStreamTrack:s})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(s);const r=new MediaStream([s]),i=t.createMediaStreamSource(r);if(s.kind!=="audio")throw n();if(e(t))throw new TypeError;return i},Wd=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,zd=(n,e,t,s,r,i)=>(o,a)=>{const c=o.createOscillator();return _e(c,a),ue(c,a,"detune"),ue(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):oe(c,a,"type"),e(t,()=>t(o))||Rr(c),e(s,()=>s(o))||i(c,o),e(r,()=>r(o))||Dr(c),n(o,c),c},Gd=n=>(e,t)=>{const s=e.createPanner();return s.orientationX===void 0?n(e,t):(_e(s,t),ue(s,t,"orientationX"),ue(s,t,"orientationY"),ue(s,t,"orientationZ"),ue(s,t,"positionX"),ue(s,t,"positionY"),ue(s,t,"positionZ"),oe(s,t,"coneInnerAngle"),oe(s,t,"coneOuterAngle"),oe(s,t,"coneOuterGain"),oe(s,t,"distanceModel"),oe(s,t,"maxDistance"),oe(s,t,"panningModel"),oe(s,t,"refDistance"),oe(s,t,"rolloffFactor"),s)},Hd=(n,e,t,s,r,i,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:p,maxDistance:m,orientationX:_,orientationY:y,orientationZ:T,panningModel:k,positionX:S,positionY:g,positionZ:w,refDistance:b,rolloffFactor:v,...O})=>{const x=u.createPanner();if(O.channelCount>2||O.channelCountMode==="max")throw o();_e(x,O);const A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},C=t(u,{...A,channelInterpretation:"speakers",numberOfInputs:6}),N=s(u,{...O,gain:1}),I=s(u,{...A,gain:1}),j=s(u,{...A,gain:0}),R=s(u,{...A,gain:0}),D=s(u,{...A,gain:0}),W=s(u,{...A,gain:0}),F=s(u,{...A,gain:0}),q=r(u,256,6,1),$=i(u,{...A,curve:new Float32Array([1,1]),oversample:"none"});let ee=[_,y,T],Ne=[S,g,w];const Re=new Float32Array(1);q.onaudioprocess=({inputBuffer:M})=>{const kt=[c(M,Re,0),c(M,Re,1),c(M,Re,2)];kt.some((Vt,Lt)=>Vt!==ee[Lt])&&(x.setOrientation(...kt),ee=kt);const St=[c(M,Re,3),c(M,Re,4),c(M,Re,5)];St.some((Vt,Lt)=>Vt!==Ne[Lt])&&(x.setPosition(...St),Ne=St)},Object.defineProperty(j.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(W.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const z={get bufferSize(){},get channelCount(){return x.channelCount},set channelCount(M){if(M>2)throw o();N.channelCount=M,x.channelCount=M},get channelCountMode(){return x.channelCountMode},set channelCountMode(M){if(M==="max")throw o();N.channelCountMode=M,x.channelCountMode=M},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(M){N.channelInterpretation=M,x.channelInterpretation=M},get coneInnerAngle(){return x.coneInnerAngle},set coneInnerAngle(M){x.coneInnerAngle=M},get coneOuterAngle(){return x.coneOuterAngle},set coneOuterAngle(M){x.coneOuterAngle=M},get coneOuterGain(){return x.coneOuterGain},set coneOuterGain(M){if(M<0||M>1)throw e();x.coneOuterGain=M},get context(){return x.context},get distanceModel(){return x.distanceModel},set distanceModel(M){x.distanceModel=M},get inputs(){return[N]},get maxDistance(){return x.maxDistance},set maxDistance(M){if(M<0)throw new RangeError;x.maxDistance=M},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},get orientationX(){return I.gain},get orientationY(){return j.gain},get orientationZ(){return R.gain},get panningModel(){return x.panningModel},set panningModel(M){x.panningModel=M},get positionX(){return D.gain},get positionY(){return W.gain},get positionZ(){return F.gain},get refDistance(){return x.refDistance},set refDistance(M){if(M<0)throw new RangeError;x.refDistance=M},get rolloffFactor(){return x.rolloffFactor},set rolloffFactor(M){if(M<0)throw new RangeError;x.rolloffFactor=M},addEventListener(...M){return N.addEventListener(M[0],M[1],M[2])},dispatchEvent(...M){return N.dispatchEvent(M[0])},removeEventListener(...M){return N.removeEventListener(M[0],M[1],M[2])}};h!==z.coneInnerAngle&&(z.coneInnerAngle=h),d!==z.coneOuterAngle&&(z.coneOuterAngle=d),f!==z.coneOuterGain&&(z.coneOuterGain=f),p!==z.distanceModel&&(z.distanceModel=p),m!==z.maxDistance&&(z.maxDistance=m),_!==z.orientationX.value&&(z.orientationX.value=_),y!==z.orientationY.value&&(z.orientationY.value=y),T!==z.orientationZ.value&&(z.orientationZ.value=T),k!==z.panningModel&&(z.panningModel=k),S!==z.positionX.value&&(z.positionX.value=S),g!==z.positionY.value&&(z.positionY.value=g),w!==z.positionZ.value&&(z.positionZ.value=w),b!==z.refDistance&&(z.refDistance=b),v!==z.rolloffFactor&&(z.rolloffFactor=v),(ee[0]!==1||ee[1]!==0||ee[2]!==0)&&x.setOrientation(...ee),(Ne[0]!==0||Ne[1]!==0||Ne[2]!==0)&&x.setPosition(...Ne);const ie=()=>{N.connect(x),n(N,$,0,0),$.connect(I).connect(C,0,0),$.connect(j).connect(C,0,1),$.connect(R).connect(C,0,2),$.connect(D).connect(C,0,3),$.connect(W).connect(C,0,4),$.connect(F).connect(C,0,5),C.connect(q).connect(u.destination)},Te=()=>{N.disconnect(x),a(N,$,0,0),$.disconnect(I),I.disconnect(C),$.disconnect(j),j.disconnect(C),$.disconnect(R),R.disconnect(C),$.disconnect(D),D.disconnect(C),$.disconnect(W),W.disconnect(C),$.disconnect(F),F.disconnect(C),C.disconnect(q),q.disconnect(u.destination)};return l(_s(z,x),ie,Te)},Jd=n=>(e,{disableNormalization:t,imag:s,real:r})=>{const i=s instanceof Float32Array?s:new Float32Array(s),o=r instanceof Float32Array?r:new Float32Array(r),a=e.createPeriodicWave(o,i,{disableNormalization:t});if(Array.from(s).length<2)throw n();return a},Us=(n,e,t,s)=>n.createScriptProcessor(e,t,s),Zd=(n,e)=>(t,s)=>{const r=s.channelCountMode;if(r==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,s);const i=t.createStereoPanner();return _e(i,s),ue(i,s,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>r,set:o=>{if(o!==r)throw e()}}),i},Xd=(n,e,t,s,r,i)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,m,_,y)=>{const T=new Float32Array(16385),k=new Float32Array(16385);for(let O=0;O<16385;O+=1){const x=O/16384*c;T[O]=Math.cos(x),k[O]=Math.sin(x)}const S=t(p,{...l,gain:0}),g=s(p,{...u,curve:T}),w=s(p,{...u,curve:a}),b=t(p,{...l,gain:0}),v=s(p,{...u,curve:k});return{connectGraph(){m.connect(S),m.connect(w.inputs===void 0?w:w.inputs[0]),m.connect(b),w.connect(_),_.connect(g.inputs===void 0?g:g.inputs[0]),_.connect(v.inputs===void 0?v:v.inputs[0]),g.connect(S.gain),v.connect(b.gain),S.connect(y,0,0),b.connect(y,0,1)},disconnectGraph(){m.disconnect(S),m.disconnect(w.inputs===void 0?w:w.inputs[0]),m.disconnect(b),w.disconnect(_),_.disconnect(g.inputs===void 0?g:g.inputs[0]),_.disconnect(v.inputs===void 0?v:v.inputs[0]),g.disconnect(S.gain),v.disconnect(b.gain),S.disconnect(y,0,0),b.disconnect(y,0,1)}}},d=(p,m,_,y)=>{const T=new Float32Array(16385),k=new Float32Array(16385),S=new Float32Array(16385),g=new Float32Array(16385),w=Math.floor(16385/2);for(let D=0;D<16385;D+=1)if(D>w){const W=(D-w)/(16384-w)*c;T[D]=Math.cos(W),k[D]=Math.sin(W),S[D]=0,g[D]=1}else{const W=D/(16384-w)*c;T[D]=1,k[D]=0,S[D]=Math.cos(W),g[D]=Math.sin(W)}const b=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=t(p,{...l,gain:0}),O=s(p,{...u,curve:T}),x=t(p,{...l,gain:0}),A=s(p,{...u,curve:k}),C=s(p,{...u,curve:a}),N=t(p,{...l,gain:0}),I=s(p,{...u,curve:S}),j=t(p,{...l,gain:0}),R=s(p,{...u,curve:g});return{connectGraph(){m.connect(b),m.connect(C.inputs===void 0?C:C.inputs[0]),b.connect(v,0),b.connect(x,0),b.connect(N,1),b.connect(j,1),C.connect(_),_.connect(O.inputs===void 0?O:O.inputs[0]),_.connect(A.inputs===void 0?A:A.inputs[0]),_.connect(I.inputs===void 0?I:I.inputs[0]),_.connect(R.inputs===void 0?R:R.inputs[0]),O.connect(v.gain),A.connect(x.gain),I.connect(N.gain),R.connect(j.gain),v.connect(y,0,0),N.connect(y,0,0),x.connect(y,0,1),j.connect(y,0,1)},disconnectGraph(){m.disconnect(b),m.disconnect(C.inputs===void 0?C:C.inputs[0]),b.disconnect(v,0),b.disconnect(x,0),b.disconnect(N,1),b.disconnect(j,1),C.disconnect(_),_.disconnect(O.inputs===void 0?O:O.inputs[0]),_.disconnect(A.inputs===void 0?A:A.inputs[0]),_.disconnect(I.inputs===void 0?I:I.inputs[0]),_.disconnect(R.inputs===void 0?R:R.inputs[0]),O.disconnect(v.gain),A.disconnect(x.gain),I.disconnect(N.gain),R.disconnect(j.gain),v.disconnect(y,0,0),N.disconnect(y,0,0),x.disconnect(y,0,1),j.disconnect(y,0,1)}}},f=(p,m,_,y,T)=>{if(m===1)return h(p,_,y,T);if(m===2)return d(p,_,y,T);throw r()};return(p,{channelCount:m,channelCountMode:_,pan:y,...T})=>{if(_==="max")throw r();const k=n(p,{...T,channelCount:1,channelCountMode:_,numberOfInputs:2}),S=t(p,{...T,channelCount:m,channelCountMode:_,gain:1}),g=t(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:w,disconnectGraph:b}=f(p,m,S,g,k);Object.defineProperty(g.gain,"defaultValue",{get:()=>0}),Object.defineProperty(g.gain,"maxValue",{get:()=>1}),Object.defineProperty(g.gain,"minValue",{get:()=>-1});const v={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount(C){S.channelCount!==C&&(O&&b(),{connectGraph:w,disconnectGraph:b}=f(p,C,S,g,k),O&&w()),S.channelCount=C},get channelCountMode(){return S.channelCountMode},set channelCountMode(C){if(C==="clamped-max"||C==="max")throw r();S.channelCountMode=C},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(C){S.channelInterpretation=C},get context(){return S.context},get inputs(){return[S]},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get pan(){return g.gain},addEventListener(...C){return S.addEventListener(C[0],C[1],C[2])},dispatchEvent(...C){return S.dispatchEvent(C[0])},removeEventListener(...C){return S.removeEventListener(C[0],C[1],C[2])}};let O=!1;const x=()=>{w(),O=!0},A=()=>{b(),O=!1};return i(_s(v,k),x,A)}},Yd=(n,e,t,s,r,i,o)=>(a,c)=>{const l=a.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);_e(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();oe(l,{curve:u},"curve"),oe(l,c,"oversample");let h=null,d=!1;return o(l,"curve",m=>()=>m.call(l),m=>_=>(m.call(l,_),d&&(s(_)&&h===null?h=n(a,l):!s(_)&&h!==null&&(h(),h=null)),_)),r(l,()=>{d=!0,s(l.curve)&&(h=n(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},Kd=(n,e,t,s,r)=>(i,{curve:o,oversample:a,...c})=>{const l=i.createWaveShaper(),u=i.createWaveShaper();_e(l,c),_e(u,c);const h=t(i,{...c,gain:1}),d=t(i,{...c,gain:-1}),f=t(i,{...c,gain:1}),p=t(i,{...c,gain:-1});let m=null,_=!1,y=null;const T={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(g){h.channelCount=g,d.channelCount=g,l.channelCount=g,f.channelCount=g,u.channelCount=g,p.channelCount=g},get channelCountMode(){return l.channelCountMode},set channelCountMode(g){h.channelCountMode=g,d.channelCountMode=g,l.channelCountMode=g,f.channelCountMode=g,u.channelCountMode=g,p.channelCountMode=g},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(g){h.channelInterpretation=g,d.channelInterpretation=g,l.channelInterpretation=g,f.channelInterpretation=g,u.channelInterpretation=g,p.channelInterpretation=g},get context(){return l.context},get curve(){return y},set curve(g){if(g!==null&&g.length<2)throw e();if(g===null)l.curve=g,u.curve=g;else{const w=g.length,b=new Float32Array(w+2-w%2),v=new Float32Array(w+2-w%2);b[0]=g[0],v[0]=-g[w-1];const O=Math.ceil((w+1)/2),x=(w+1)/2-1;for(let A=1;A<O;A+=1){const C=A/O*x,N=Math.floor(C),I=Math.ceil(C);b[A]=N===I?g[N]:(1-(C-N))*g[N]+(1-(I-C))*g[I],v[A]=N===I?-g[w-1-N]:-((1-(C-N))*g[w-1-N])-(1-(I-C))*g[w-1-I]}b[O]=w%2===1?g[O-1]:(g[O-2]+g[O-1])/2,l.curve=b,u.curve=v}y=g,_&&(s(y)&&m===null?m=n(i,h):m!==null&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(g){l.oversample=g,u.oversample=g},addEventListener(...g){return h.addEventListener(g[0],g[1],g[2])},dispatchEvent(...g){return h.dispatchEvent(g[0])},removeEventListener(...g){return h.removeEventListener(g[0],g[1],g[2])}};o!==null&&(T.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==T.oversample&&(T.oversample=a);const k=()=>{h.connect(l).connect(f),h.connect(d).connect(u).connect(p).connect(f),_=!0,s(y)&&(m=n(i,h))},S=()=>{h.disconnect(l),l.disconnect(f),h.disconnect(d),d.disconnect(u),u.disconnect(p),p.disconnect(f),_=!1,m!==null&&(m(),m=null)};return r(_s(T,f),k,S)},Ae=()=>new DOMException("","NotSupportedError"),Qd={numberOfChannels:1},ef=(n,e,t,s,r)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...Qd,...l},f=s(h,u,d);e(Ds,()=>Ds(f))||f.addEventListener("statechange",(()=>{let p=0;const m=_=>{this._state==="running"&&(p>0?(f.removeEventListener("statechange",m),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):p+=1)};return m})()),super(f,h),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,qo(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},tf={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},sf=(n,e,t,s,r,i,o)=>class extends n{constructor(c,l){const u=r(c),h={...tf,...l},d=t(u,h),f=i(u),p=f?s():null,m=c.sampleRate/2;super(c,!1,d,p),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){cs(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),rt(this)&&Vs(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},nf=(n,e,t,s,r)=>()=>{const i=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=t(u);const f=be(d,h);if(!f){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,p),a!==null&&d.start(a),c!==null&&d.stop(c)}return i.set(h,d),f?(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)):(await s(h,u.detune,d.detune),await s(h,u.frequency,d.frequency)),await r(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=i.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},rf={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},of=(n,e,t,s,r,i,o)=>class extends n{constructor(c,l){const u=r(c),h={...rf,...l},d=t(u,h),f=i(u),p=f?s():null;super(c,!1,d,p),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,ke,Pe),this._orientationY=e(this,f,d.orientationY,ke,Pe),this._orientationZ=e(this,f,d.orientationZ,ke,Pe),this._positionX=e(this,f,d.positionX,ke,Pe),this._positionY=e(this,f,d.positionY,ke,Pe),this._positionZ=e(this,f,d.positionZ,ke,Pe),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},af=(n,e,t,s,r,i,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(f,p)=>{let m=null,_=i(f);const y={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},T={...y,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},k=be(_,p);if("bufferSize"in _)m=s(p,{...y,gain:1});else if(!k){const S={...T,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=r(p,S)}if(u.set(p,m===null?_:m),m!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const A=new o(6,f.context.length,p.sampleRate),C=e(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});C.connect(A.destination),h=(async()=>{const N=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(I,j)=>{const R=t(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:j===0?1:0});return await a(A,I,R.offset),R}));for(let I=0;I<6;I+=1)N[I].connect(C,0,I),N[I].start(0);return l(A)})()}const S=await h,g=s(p,{...y,gain:1});await c(f,p,g);const w=[];for(let A=0;A<S.numberOfChannels;A+=1)w.push(S.getChannelData(A));let b=[w[0][0],w[1][0],w[2][0]],v=[w[3][0],w[4][0],w[5][0]],O=s(p,{...y,gain:1}),x=r(p,{...T,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:v[0],positionY:v[1],positionZ:v[2]});g.connect(O).connect(x.inputs[0]),x.connect(m);for(let A=128;A<S.length;A+=128){const C=[w[0][A],w[1][A],w[2][A]],N=[w[3][A],w[4][A],w[5][A]];if(C.some((I,j)=>I!==b[j])||N.some((I,j)=>I!==v[j])){b=C,v=N;const I=A/p.sampleRate;O.gain.setValueAtTime(0,I),O=s(p,{...y,gain:0}),x=r(p,{...T,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),O.gain.setValueAtTime(1,I),g.connect(O).connect(x.inputs[0]),x.connect(m)}}return m}return k?(await n(p,f.orientationX,_.orientationX),await n(p,f.orientationY,_.orientationY),await n(p,f.orientationZ,_.orientationZ),await n(p,f.positionX,_.positionX),await n(p,f.positionY,_.positionY),await n(p,f.positionZ,_.positionZ)):(await a(p,f.orientationX,_.orientationX),await a(p,f.orientationY,_.orientationY),await a(p,f.orientationZ,_.orientationZ),await a(p,f.positionX,_.positionX),await a(p,f.positionY,_.positionY),await a(p,f.positionZ,_.positionZ)),ms(_)?await c(f,p,_.inputs[0]):await c(f,p,_),_};return{render(f,p){const m=u.get(p);return m!==void 0?Promise.resolve(m):d(f,p)}}},cf={disableNormalization:!1},lf=(n,e,t,s)=>class Yo{constructor(i,o){const a=e(i),c=s({...cf,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===Yo.prototype||t.has(i)}},uf=(n,e)=>(t,s,r)=>(n(s).replay(r),e(s,t,r)),hf=(n,e,t)=>async(s,r,i)=>{const o=n(s);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,r),f=s.context.destination;!t(l)&&(s!==f||!t(s))&&d.connect(i,u,c)})).reduce((a,c)=>[...a,...c],[]))},df=(n,e,t)=>async(s,r,i)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,r);t(a)||u.connect(i,c)}))},ff=(n,e,t,s)=>r=>n(Ds,()=>Ds(r))?Promise.resolve(n(s,s)).then(i=>{if(!i){const o=t(r,512,0,1);r.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>r.currentTime,o.connect(r.destination)}return r.startRendering()}):new Promise(i=>{const o=e(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.oncomplete=a=>{o.disconnect(),i(a.renderedBuffer)},o.connect(r.destination),r.startRendering()}),pf=n=>(e,t)=>{n.set(e,t)},mf=n=>(e,t)=>n.set(e,t),_f=(n,e,t,s,r,i,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(s(l)).map(u=>t(u).render(u,l)))).then(()=>r(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),Er(u)):e(i,()=>i(u))||a(u),n.add(u),u)),gf={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},yf=(n,e,t,s,r,i)=>class extends n{constructor(a,c){const l=r(a),u={...gf,...c},h=t(l,u),d=i(l),f=d?s():null;super(a,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},vf=(n,e,t,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=be(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return i.set(c,l),u?await n(c,a.pan,l.pan):await s(c,a.pan,l.pan),ms(l)?await r(a,c,l.inputs[0]):await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},wf=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},bf=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),r=URL.createObjectURL(t);let i=!1,o=!1;try{await s.audioWorklet.addModule(r);const a=new n(s,"a",{numberOfOutputs:0}),c=s.createOscillator();a.port.onmessage=()=>i=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(r)}return i&&!o},Tf=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(r=>{t.oncomplete=()=>{s.disconnect(),r(t.currentTime!==0)},t.startRendering()})},kf=()=>new DOMException("","UnknownError"),Sf={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Cf=(n,e,t,s,r,i,o)=>class extends n{constructor(c,l){const u=r(c),h={...Sf,...l},d=t(u,h),p=i(u)?s():null;super(c,!0,d,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},Af=(n,e,t)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=e(i);if(!be(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return s.set(o,a),ms(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},xf=()=>typeof window>"u"?null:window,Of=(n,e)=>t=>{t.copyFromChannel=(s,r,i=0)=>{const o=n(i),a=n(r);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)s[h]=l[h+o]},t.copyToChannel=(s,r,i=0)=>{const o=n(i),a=n(r);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=s.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=s[h]}},Ef=n=>e=>{e.copyFromChannel=(t=>(s,r,i=0)=>{const o=n(i),a=n(r);if(o<e.length)return t.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(s,r,i=0)=>{const o=n(i),a=n(r);if(o<e.length)return t.call(e,s,a,o)})(e.copyToChannel)},If=n=>(e,t)=>{const s=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=s),n(e,"buffer",r=>()=>{const i=r.call(e);return i===s?null:i},r=>i=>r.call(e,i===null?s:i))},Nf=(n,e)=>(t,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const r=t.createBufferSource();e(s,()=>{const a=s.numberOfInputs;for(let c=0;c<a;c+=1)r.connect(s,0,c)},()=>r.disconnect(s))},Ko=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),Qo=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},Bs=(n,e,t,s)=>{let r=n;for(;!r.hasOwnProperty(e);)r=Object.getPrototypeOf(r);const{get:i,set:o}=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(n,e,{get:t(i),set:s(o)})},Rf=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),Df=n=>({...n,channelCount:n.numberOfOutputs}),Pf=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},ea=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(s){if(s.code!==9)throw s;ea(n,e,t+1e-7)}},Mf=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},jf=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},Ff=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Pr=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},ta=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},Mr=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},Vf=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},Lf=n=>{n.start=(e=>(t=0,s=0,r)=>{const i=n.buffer,o=i===null?s:Math.min(i.duration,s);i!==null&&o>i.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,r)})(n.start)},sa=(n,e)=>{const t=e.createGain();n.connect(t);const s=(r=>()=>{r.call(n,t),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),_s(n,t),n.stop=(r=>{let i=!1;return(o=0)=>{if(i)try{r.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else r.call(n,o),i=!0}})(n.stop)},gs=(n,e)=>t=>{const s={value:n};return Object.defineProperties(t,{currentTarget:s,target:s}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},$f=iu(Mt),qf=hu(Mt),Uf=kh(xn),na=new WeakMap,Bf=qh(na),ze=Qu(new Map,new WeakMap),Ze=xf(),ra=gd(ze,Ke),jr=$h(Se),we=hf(Se,jr,It),Wf=_u(ra,re,we),ne=Wh(An),at=Wd(Ze),te=ad(at),ia=new WeakMap,oa=Dh(gs),Ws=bd(Ze),Fr=nd(Ws),Vr=rd(Ze),aa=id(Ze),Ps=kd(Ze),fe=qu(ou(Po),uu($f,qf,pn,Uf,mn,Se,Bf,Fs,re,Mt,rt,It,an),ze,Kh(dr,mn,Se,re,Rs,rt),Ke,On,Ae,vh(pn,dr,Se,re,Rs,ne,rt,te),Ah(ia,Se,We),oa,ne,Fr,Vr,aa,te,Ps),zf=mu(fe,Wf,Ke,ra,ne,te),Lr=new WeakSet,no=yd(Ze),ca=dh(new Uint32Array(1)),$r=Of(ca,Ke),qr=Ef(ca),la=yu(Lr,ze,Ae,no,at,wf(no),$r,qr),En=du(Ie),ua=df(jr,Ls,It),Qe=oh(ua),ys=wd(En,ze,Mf,jf,Ff,Pr,ta,Mr,Lf,If(Bs),sa),et=uf(Uh(Ls),ua),Gf=bu(Qe,ys,re,et,we),Ge=Uu(au(Mo),ia,Or,Bu,Ql,eu,tu,su,nu,lr,Ro,Ws,ea),Hf=wu(fe,Gf,Ge,ve,ys,ne,te,gs),Jf=Iu(fe,Nu,Ke,ve,Td(Ie,Bs),ne,te,we),Zf=Ku(Qe,Zo,re,et,we),jt=mf(na),Xf=Yu(fe,Ge,Zf,On,Zo,ne,te,jt),wt=md(Mt,Vr),Yf=Nf(ve,wt),bt=Id(Ws,Yf),Kf=sh(bt,re,we),Qf=th(fe,Kf,bt,ne,te),ep=ih(qs,re,we),tp=rh(fe,ep,qs,ne,te,Df),sp=Dd(En,ys,Ie,wt),vs=Rd(En,ze,sp,Pr,Mr),np=hh(Qe,vs,re,et,we),rp=uh(fe,Ge,np,vs,ne,te,gs),ha=Pd(Ae,Bs),ip=mh(ha,re,we),op=ph(fe,ip,ha,ne,te,jt),ap=Th(Qe,Xo,re,et,we),cp=bh(fe,Ge,ap,Xo,ne,te,jt),da=Md(Ae),lp=Ih(Qe,da,re,et,we),up=Eh(fe,Ge,lp,da,Ae,ne,te,jt),hp=Vh(Qe,Ie,re,et,we),dp=Fh(fe,Ge,hp,Ie,ne,te),fp=Ld(On,ve,Us,Ae),In=ff(ze,Ie,Us,Tf(Ie,at)),pp=Yh(ys,re,at,we,In),mp=jd(fp),_p=Zh(fe,mp,pp,ne,te,jt),gp=Ru(Ge,bt,vs,Us,Ae,Ko,te,Bs),fa=new WeakMap,yp=pd(Jf,gp,oa,te,fa,gs),pa=zd(En,ze,Pr,ta,Mr,sa),vp=nf(Qe,pa,re,et,we),wp=sf(fe,Ge,pa,vp,ne,te,gs),ma=ch(ys),bp=Kd(ma,ve,Ie,Qo,wt),Nn=Yd(ma,ve,bp,Qo,wt,Ws,Bs),Tp=Hd(pn,ve,bt,Ie,Us,Nn,Ae,mn,Ko,wt),_a=Gd(Tp),kp=af(Qe,bt,vs,Ie,_a,re,at,et,we,In),Sp=of(fe,Ge,_a,kp,ne,te,jt),Cp=Jd(Ke),Ap=lf(Cp,ne,new WeakSet,Pf),xp=Xd(bt,qs,Ie,Nn,Ae,wt),ga=Zd(xp,Ae),Op=vf(Qe,ga,re,et,we),Ep=yf(fe,Ge,ga,Op,ne,te),Ip=Af(Nn,re,we),Np=Cf(fe,ve,Nn,Ip,ne,te,jt),ya=cd(Ze),Ur=Ph(Ze),va=new WeakMap,Rp=zh(va,at),Dp=ya?lu(ze,Ae,Rh(Ze),Ur,Mh(ru),ne,Rp,te,Ps,new WeakMap,new WeakMap,bf(Ps,at),Ze):void 0,Pp=od(Fr,te),Mp=yh(Lr,ze,gh,Nh,new WeakSet,ne,Pp,dn,Ds,$r,qr),wa=Zu(Dp,zf,la,Hf,Xf,Qf,tp,rp,op,Mp,cp,up,dp,_p,yp,wp,Sp,Ap,Ep,Np),jp=ld(fe,$d,ne,te),Fp=hd(fe,qd,ne,te),Vp=dd(fe,Ud,ne,te),Lp=Bd(ve,te),$p=fd(fe,Lp,ne),qp=Eu(wa,ve,Ae,kf,jp,Fp,Vp,$p,Ws),Br=Gh(fa),Up=fu(Br),ba=ah(Ke),Bp=Sh(Br),Ta=xh(Ke),ka=new WeakMap,Wp=Lh(ka,We),zp=Ed(ba,Ke,ve,bt,qs,vs,Ie,Us,Ae,Ta,Ur,Wp,wt),Gp=Cd(ve,zp,Ie,Ae,wt),Hp=Ju(Qe,ba,ys,bt,qs,vs,Ie,Bp,Ta,Ur,re,Ps,at,et,we,In),Jp=Bh(va),Zp=pf(ka),ro=ya?zu(Up,fe,Ge,Hp,Gp,Se,Jp,ne,te,Ps,Rf,Zp,Vf,gs):void 0,Xp=_h(Ae,at),Yp=_f(Lr,ze,jr,Br,In,dn,$r,qr),Kp=ef(wa,ze,ve,Xp,Yp),Qp=Qh(An,Fr),em=ed(xr,Vr),tm=td(Or,aa),sm=sd(An,te);function Ve(n){return n===void 0}function H(n){return n!==void 0}function nm(n){return typeof n=="function"}function Nt(n){return typeof n=="number"}function Et(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function rm(n){return typeof n=="boolean"}function Be(n){return Array.isArray(n)}function it(n){return typeof n=="string"}function rn(n){return it(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function B(n,e){if(!n)throw new Error(e)}function Xe(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function Sa(n){!n.isOffline&&n.state!=="running"&&Wr('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Ca=!1,io=!1;function oo(n){Ca=n}function im(n){Ve(n)&&Ca&&!io&&(io=!0,Wr("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Aa=console;function om(...n){Aa.log(...n)}function Wr(...n){Aa.warn(...n)}function am(n){return new qp(n)}function cm(n,e,t){return new Kp(n,e,t)}const Me=typeof self=="object"?self:null,lm=Me&&(Me.hasOwnProperty("AudioContext")||Me.hasOwnProperty("webkitAudioContext"));function um(n,e,t){return B(H(ro),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof(Me==null?void 0:Me.BaseAudioContext)?Me==null?void 0:Me.AudioWorkletNode:ro)(n,e,t)}function He(n,e,t,s){var r=arguments.length,i=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,s);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(i=(r<3?o(i):r>3?o(e,t,i):o(e,t))||i);return r>3&&i&&Object.defineProperty(e,t,i),i}function de(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((s=s.apply(n,e||[])).next())})}class hm{constructor(e,t,s,r){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(r||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),s=new Worker(t);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function Rt(n){return tm(n)}function gt(n){return em(n)}function cn(n){return sm(n)}function Xt(n){return Qp(n)}function dm(n){return n instanceof la}function fm(n,e){return n==="value"||Rt(e)||gt(e)||dm(e)}function ss(n,...e){if(!e.length)return n;const t=e.shift();if(Et(n)&&Et(t))for(const s in t)fm(s,t[s])?n[s]=t[s]:Et(t[s])?(n[s]||Object.assign(n,{[s]:{}}),ss(n[s],t[s])):Object.assign(n,{[s]:t[s]});return ss(n,...e)}function pm(n,e){return n.length===e.length&&n.every((t,s)=>e[s]===t)}function P(n,e,t=[],s){const r={},i=Array.from(e);if(Et(i[0])&&s&&!Reflect.has(i[0],s)&&(Object.keys(i[0]).some(a=>Reflect.has(n,a))||(ss(r,{[s]:i[0]}),t.splice(t.indexOf(s),1),i.shift())),i.length===1&&Et(i[0]))ss(r,i[0]);else for(let o=0;o<t.length;o++)H(i[o])&&(r[t[o]]=i[o]);return ss(n,r)}function mm(n){return n.constructor.getDefaults()}function ns(n,e){return Ve(n)?e:n}function ao(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class ct{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Me&&this.toString()===Me.TONE_DEBUG_CLASS)&&om(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}ct.version=No;const zr=1e-6;function ls(n,e){return n>e+zr}function gr(n,e){return ls(n,e)||qe(n,e)}function vn(n,e){return n+zr<e}function qe(n,e){return Math.abs(n-e)<zr}function _m(n,e,t){return Math.max(Math.min(n,t),e)}class Le extends ct{constructor(){super(),this.name="Timeline",this._timeline=[];const e=P(Le.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(B(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];B(gr(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const s=this._search(e,t);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const s=this._search(e,t);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const s=this._search(e);return s-1>=0?this._timeline[s-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(qe(this._timeline[t].time,e)){for(let s=t;s>=0&&qe(this._timeline[s].time,e);s--)t=s;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&gr(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let s=0;const r=this._timeline.length;let i=r;if(r>0&&this._timeline[r-1][t]<=e)return r-1;for(;s<i;){let o=Math.floor(s+(i-s)/2);const a=this._timeline[o],c=this._timeline[o+1];if(qe(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(qe(u[t],e))o=l;else break}return o}else{if(vn(a[t],e)&&ls(c[t],e))return o;ls(a[t],e)?i=o:s=o+1}}return-1}_iterate(e,t=0,s=this._timeline.length-1){this._timeline.slice(t,s+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const s=this._search(e);return s!==-1&&this._iterate(t,0,s),this}forEachAfter(e,t){const s=this._search(e);return this._iterate(t,s+1),this}forEachBetween(e,t,s){let r=this._search(e),i=this._search(t);return r!==-1&&i!==-1?(this._timeline[r].time!==e&&(r+=1),this._timeline[i].time===t&&(i-=1),this._iterate(s,r,i)):r===-1&&this._iterate(s,0,i),this}forEachFrom(e,t){let s=this._search(e);for(;s>=0&&this._timeline[s].time>=e;)s--;return this._iterate(t,s+1),this}forEachAtTime(e,t){const s=this._search(e);if(s!==-1&&qe(this._timeline[s].time,e)){let r=s;for(let i=s;i>=0&&qe(this._timeline[i].time,e);i--)r=i;this._iterate(i=>{t(i)},r,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const xa=[];function Rn(n){xa.push(n)}function gm(n){xa.forEach(e=>e(n))}const Oa=[];function Dn(n){Oa.push(n)}function ym(n){Oa.forEach(e=>e(n))}class zs extends ct{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(r=>{Ve(this._events)&&(this._events={}),this._events.hasOwnProperty(r)||(this._events[r]=[]),this._events[r].push(t)}),this}once(e,t){const s=(...r)=>{t(...r),this.off(e,s)};return this.on(e,s),this}off(e,t){return e.split(/\W+/).forEach(r=>{if(Ve(this._events)&&(this._events={}),this._events.hasOwnProperty(r))if(Ve(t))this._events[r]=[];else{const i=this._events[r];for(let o=i.length-1;o>=0;o--)i[o]===t&&i.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const s=this._events[e].slice(0);for(let r=0,i=s.length;r<i;r++)s[r].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const s=Object.getOwnPropertyDescriptor(zs.prototype,t);Object.defineProperty(e.prototype,t,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class Ea extends zs{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Gs extends Ea{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Le,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=P(Gs.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=am({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new hm(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(gm(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,s){return this._context.createBuffer(e,t,s)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,s){return this._context.createPeriodicWave(e,t,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return B(Xt(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return B(Xt(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return B(Xt(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){B(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){B(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){B(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){B(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return um(this.rawContext,e,t)}addAudioWorkletModule(e){return de(this,void 0,void 0,function*(){B(H(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return de(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Xt(this._context)?this._context.resume():Promise.resolve()}close(){return de(this,void 0,void 0,function*(){Xt(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&ym(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),s=t.getChannelData(0);for(let i=0;i<s.length;i++)s[i]=e;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=t,r.loop=!0,r.start(0),this._constants.set(e,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:s+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const s=++this._timeoutIds,r=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),r()},id:s,time:i+t})};return r(),s}}class vm extends Ea{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,s){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return de(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Q(n,e){Be(e)?e.forEach(t=>Q(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function Ia(n,e){Be(e)?e.forEach(t=>Ia(n,t)):Object.defineProperty(n,e,{writable:!0})}const X=()=>{};class Y extends ct{constructor(){super(),this.name="ToneAudioBuffer",this.onload=X;const e=P(Y.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,it(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:X,onload:X,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Oe().sampleRate}set(e){return e instanceof Y?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return de(this,void 0,void 0,function*(){const t=Y.load(e).then(s=>{this.set(s),this.onload(this)});Y.downloads.push(t);try{yield t}finally{const s=Y.downloads.indexOf(t);Y.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Be(e)&&e[0].length>0,s=t?e.length:1,r=t?e[0].length:e.length,i=Oe(),o=i.createBuffer(s,r,i.sampleRate),a=!t&&s===1?[e]:e;for(let c=0;c<s;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(Nt(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const s=this.numberOfChannels;for(let r=0;r<s;r++){const i=this.toArray(r);for(let o=0;o<i.length;o++)t[o]+=i[o]}t=t.map(r=>r/s),this.fromArray(t)}return this}toArray(e){if(Nt(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let s=0;s<this.numberOfChannels;s++)t[s]=this.getChannelData(s);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){B(this.loaded,"Buffer is not loaded");const s=Math.floor(e*this.sampleRate),r=Math.floor(t*this.sampleRate);B(s<r,"The start time must be less than the end time");const i=r-s,o=Oe().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,r),a);return new Y(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Y().fromArray(e)}static fromUrl(e){return de(this,void 0,void 0,function*(){return yield new Y().load(e)})}static load(e){return de(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let l=c[0];for(const u of c)if(Y.supportsType(u)){l=u;break}e=e.replace(t[0],l)}const s=Y.baseUrl===""||Y.baseUrl.endsWith("/")?Y.baseUrl:Y.baseUrl+"/",r=document.createElement("a");r.href=s+e,r.pathname=(r.pathname+r.hash).split("/").map(encodeURIComponent).join("/");const i=yield fetch(r.href);if(!i.ok)throw new Error(`could not load url: ${e}`);const o=yield i.arrayBuffer();return yield Oe().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),s=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return de(this,void 0,void 0,function*(){for(yield Promise.resolve();Y.downloads.length;)yield Y.downloads[0]})}}Y.baseUrl="";Y.downloads=[];class Hs extends Gs{constructor(){super({clockSource:"offline",context:cn(arguments[0])?arguments[0]:cm(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:cn(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=cn(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return de(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const s=Math.floor(this.sampleRate/128);e&&t%s===0&&(yield new Promise(r=>setTimeout(r,1)))}})}render(){return de(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Y(t)})}close(){return Promise.resolve()}}const Na=new vm;let Ot=Na;function Oe(){return Ot===Na&&lm&&yr(new Gs),Ot}function yr(n,e=!1){e&&Ot.dispose(),Xt(n)?Ot=new Gs(n):cn(n)?Ot=new Hs(n):Ot=n}function wm(){return Ot.resume()}if(Me&&!Me.TONE_SILENCE_LOGGING){const e=` * Tone.js v${No} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function bm(n){return Math.pow(10,n/20)}function Tm(n){return 20*(Math.log(n)/Math.LN10)}function wn(n){return Math.pow(2,n/12)}let Pn=440;function km(){return Pn}function Sm(n){Pn=n}function vr(n){return Math.round(Ra(n))}function Ra(n){return 69+12*Math.log2(n/Pn)}function Cm(n){return Pn*Math.pow(2,(n-69)/12)}class Gr extends ct{constructor(e,t,s){super(),this.defaultUnits="s",this._val=t,this._units=s,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const s=parseInt(e,10),r=t==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/s)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,s)=>{let r=0;return e&&e!=="0"&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(r+=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(r+=this._beatsToUnits(parseFloat(s)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Gr&&this.fromType(this._val),Ve(this._val))return this._noArg();if(it(this._val)&&Ve(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Et(this._val)){let e=0;for(const t in this._val)if(H(this._val[t])){const s=this._val[t],r=new this.constructor(this.context,t).valueOf()*s;e+=r}return e}if(H(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return it(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Ue extends Gr{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Ue(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const s=new this.constructor(this.context,e).valueOf(),r=this.valueOf(),a=Math.round(r/s)*s-r;return r+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let s=t[0],r=new Ue(this.context,t[0]).toSeconds();return t.forEach(i=>{const o=new Ue(this.context,i).toSeconds();Math.abs(o-e)<Math.abs(r-e)&&(s=i,r=o)}),s}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const s=Math.floor(t/this._getTimeSignature());let r=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=r.toString();return i.length>3&&(r=parseFloat(parseFloat(i).toFixed(3))),[s,t,r].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return vr(this.toFrequency())}_now(){return this.context.now()}}class Fe extends Ue{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return km()}static set A4(e){Sm(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Fe.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const r=Am[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?r:Fe.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,s){let r=1;return e&&e!=="0"&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(r*=this._beatsToUnits(parseFloat(t))),s&&s!=="0"&&(r*=this._beatsToUnits(parseFloat(s)/4)),r}}})}transpose(e){return new Fe(this.context,this.valueOf()*wn(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return vr(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Fe.A4);let s=Math.round(12*t)+57;const r=Math.floor(s/12);return r<0&&(s+=-12*r),xm[s%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return Cm(e)}static ftom(e){return vr(e)}}const Am={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},xm=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Es extends Ue{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ee extends ct{constructor(){super();const e=P(Ee.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Oe()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return im(e),new Ue(this.context,e).toSeconds()}toFrequency(e){return new Fe(this.context,e).toFrequency()}toTicks(e){return new Es(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(s=>{Ve(e[s])&&delete t[s]}),t}get(){const e=mm(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const s=this[t];H(s)&&H(s.value)&&H(s.setValueAtTime)?e[t]=s.value:s instanceof Ee?e[t]=s._getPartialProperties(e[t]):Be(s)||Nt(s)||it(s)||rm(s)?e[t]=s:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&H(this[t])&&(this[t]&&H(this[t].value)&&H(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Ee?this[t].set(e[t]):this[t]=e[t])}),this}}class Hr extends Le{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,s){return Xe(t,0),this.add(Object.assign({},s,{state:e,time:t})),this}getLastState(e,t){const s=this._search(t);for(let r=s;r>=0;r--){const i=this._timeline[r];if(i.state===e)return i}}getNextState(e,t){const s=this._search(t);if(s!==-1)for(let r=s;r<this._timeline.length;r++){const i=this._timeline[r];if(i.state===e)return i}}}class Z extends Ee{constructor(){const e=P(Z.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,B(H(e.param)&&(Rt(e.param)||e.param instanceof Z),"param must be an AudioParam");!Rt(e.param);)e.param=e.param._param;this._swappable=H(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Le(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,H(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ee.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return H(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return H(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return H(this.maxValue)&&H(this.minValue)&&Xe(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?bm(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Tm(e):e}setValueAtTime(e,t){const s=this.toSeconds(t),r=this._fromType(e);return B(isFinite(r)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(r),this.log(this.units,"setValueAtTime",e,s),this._events.add({time:s,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,s),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),s=this._events.getAfter(t),r=this._events.get(t);let i=this._initialValue;if(r===null)i=this._initialValue;else if(r.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(r.time);let a;o===null?a=this._initialValue:a=o.value,r.type==="setTargetAtTime"&&(i=this._exponentialApproach(r.time,a,r.value,r.constant,t))}else if(s===null)i=r.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=r.value;if(r.type==="setTargetAtTime"){const a=this._events.getBefore(r.time);a===null?o=this._initialValue:o=a.value}s.type==="linearRampToValueAtTime"?i=this._linearInterpolate(r.time,o,s.time,s.value,t):i=this._exponentialInterpolate(r.time,o,s.time,s.value,t)}else i=r.value;return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const s=this._fromType(e),r=this.toSeconds(t);return B(isFinite(s)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this._events.add({time:r,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",e,r),this._param.linearRampToValueAtTime(s,r),this}exponentialRampToValueAtTime(e,t){let s=this._fromType(e);s=qe(s,0)?this._minOutput:s,this._assertRange(s);const r=this.toSeconds(t);return B(isFinite(s)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",e,r),this._param.exponentialRampToValueAtTime(s,r),this}exponentialRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(e,s+this.toSeconds(t)),this}linearRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(e,s+this.toSeconds(t)),this}targetRampTo(e,t,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(e,s,t),this}exponentialApproachValueAtTime(e,t,s){t=this.toSeconds(t),s=this.toSeconds(s);const r=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(e,t,r),this.cancelAndHoldAtTime(t+s*.9),this.linearRampToValueAtTime(e,t+s),this}setTargetAtTime(e,t,s){const r=this._fromType(e);B(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(r),B(isFinite(r)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:s,time:i,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",e,i,s),this._param.setTargetAtTime(r,i,s),this}setValueCurveAtTime(e,t,s,r=1){s=this.toSeconds(s),t=this.toSeconds(t);const i=this._fromType(e[0])*r;this.setValueAtTime(this._toType(i),t);const o=s/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*r;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return B(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),s=this._fromType(this.getValueAtTime(t));B(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+s);const r=this._events.get(t),i=this._events.getAfter(t);return r&&qe(r.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),t):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),t)),this._events.add({time:t,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,t),this}rampTo(e,t=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,s):this.linearRampTo(e,t,s),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const s=this._events.get(t);if(s&&s.type==="setTargetAtTime"){const r=this._events.getAfter(s.time),i=r?r.time:t+2,o=(i-t)/10;for(let a=t;a<i;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,r=>{r.type==="cancelScheduledValues"?e.cancelScheduledValues(r.time):r.type==="setTargetAtTime"?e.setTargetAtTime(r.value,r.time,r.constant):e[r.type](r.value,r.time)}),this}setParam(e){B(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,s,r,i){return s+(t-s)*Math.exp(-(i-e)/r)}_linearInterpolate(e,t,s,r,i){return t+(r-t)*((i-e)/(s-e))}_exponentialInterpolate(e,t,s,r,i){return t*Math.pow(r/t,(i-e)/(s-e))}}class L extends Ee{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return H(this.input)?Rt(this.input)||this.input instanceof Z?1:this.input.numberOfInputs:0}get numberOfOutputs(){return H(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return H(e)&&(e instanceof L||gt(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(s=>{s.channelCount=e.channelCount,s.channelCountMode=e.channelCountMode,s.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();B(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,s=0){return ot(this,e,t,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Wr("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,s=0){return Da(this,e,t,s),this}chain(...e){return Ms(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),H(this.input)&&(this.input instanceof L?this.input.dispose():gt(this.input)&&this.input.disconnect()),H(this.output)&&(this.output instanceof L?this.output.dispose():gt(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Ms(...n){const e=n.shift();n.reduce((t,s)=>(t instanceof L?t.connect(s):gt(t)&&ot(t,s),s),e)}function ot(n,e,t=0,s=0){for(B(H(n),"Cannot connect from undefined node"),B(H(e),"Cannot connect to undefined node"),(e instanceof L||gt(e))&&B(e.numberOfInputs>0,"Cannot connect to node with no inputs"),B(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof L||e instanceof Z;)H(e.input)&&(e=e.input);for(;n instanceof L;)H(n.output)&&(n=n.output);Rt(e)?n.connect(e,t):n.connect(e,t,s)}function Da(n,e,t=0,s=0){if(H(e))for(;e instanceof L;)e=e.input;for(;!gt(n);)H(n.output)&&(n=n.output);Rt(e)?n.disconnect(e,t):gt(e)?n.disconnect(e,t,s):n.disconnect()}class K extends L{constructor(){const e=P(K.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Z({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Q(this,"gain")}static getDefaults(){return Object.assign(L.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class us extends L{constructor(e){super(e),this.onended=X,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new K({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const s=this.toSeconds(t);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(L.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:X})}_startGain(e,t=1){B(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=e+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+s):this._gainNode.gain.exponentialApproachValueAtTime(t,e,s)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){B(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==X&&(this.onended(this),this.onended=X,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),B(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=X,this}}class Jr extends us{constructor(){const e=P(Jr.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),ot(this._source,this._gainNode),this.offset=new Z({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(us.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ae extends L{constructor(){const e=P(ae.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new Jr({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(L.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,s=0){return Mn(this,e,t,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,s){return this._param.exponentialRampTo(e,t,s),this}linearRampTo(e,t,s){return this._param.linearRampTo(e,t,s),this}targetRampTo(e,t,s){return this._param.targetRampTo(e,t,s),this}exponentialApproachValueAtTime(e,t,s){return this._param.exponentialApproachValueAtTime(e,t,s),this}setTargetAtTime(e,t,s){return this._param.setTargetAtTime(e,t,s),this}setValueCurveAtTime(e,t,s,r){return this._param.setValueCurveAtTime(e,t,s,r),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,s){return this._param.rampTo(e,t,s),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Mn(n,e,t,s){(e instanceof Z||Rt(e)||e instanceof ae&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ae&&(e.overridden=!0)),ot(n,e,t,s)}class Zr extends Z{constructor(){const e=P(Zr.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Le(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Z.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,s){t=this.toSeconds(t),this.setRampPoint(t);const r=this._fromType(e),i=this._events.get(t),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const c=s*a+t,l=this._exponentialApproach(i.time,i.value,r,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const s=this.toSeconds(t);super.setValueAtTime(e,t);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const s=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const s=this._fromType(e),r=this._events.get(t),i=Math.round(Math.max((t-r.time)*10,1)),o=(t-r.time)/i;for(let a=0;a<=i;a++){const c=o*a+r.time,l=this._exponentialInterpolate(r.time,r.value,t,s,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Ve(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const s=this._fromType(this.getValueAtTime(e.time));let r=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&i.type==="setValueAtTime"&&(r=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(s+r)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),s=this._events.get(t);return Math.max(this._getTicksUntilEvent(s,t),0)}getDurationOfTicks(e,t){const s=this.toSeconds(t),r=this.getTicksAtTime(t);return this.getTimeOfTick(r+e)-s}getTimeOfTick(e){const t=this._events.get(e,"ticks"),s=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&s&&s.type==="linearRampToValueAtTime"&&t.value!==s.value){const r=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(s.time))-r)/(s.time-t.time),a=Math.sqrt(Math.pow(r,2)-2*o*(t.ticks-e)),c=(-r+a)/o,l=(-r-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const s=this.toSeconds(t),r=this.toSeconds(e),i=this.getTicksAtTime(s);return this.getTicksAtTime(s+r)-i}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class Xr extends ae{constructor(){const e=P(Xr.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new Zr({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ae.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class Yr extends Ee{constructor(){const e=P(Yr.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new Hr,this._tickOffset=new Le,this._ticksAtTime=new Le,this._secondsAtTime=new Le,this.frequency=new Xr({context:this.context,units:e.units,value:e.frequency}),Q(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ee.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const s=this.toSeconds(e);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),H(t)&&this.setTicksAtTime(t,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const s=this._state.get(t);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),s=this._state.getLastState("stopped",t),r=this._ticksAtTime.get(t),i={state:"paused",time:t};this._state.add(i);let o=r||s,a=r?r.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==i.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(i),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),s=this.frequency.timeToTicks(e,t);this.setTicksAtTime(s,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);const r=this._secondsAtTime.get(e);let i=r||t,o=r?r.seconds:0,a=null;return this._state.forEachBetween(i.time,e+this.sampleTime,c=>{let l=i.time;const u=this._tickOffset.get(c.time);u&&u.time>=i.time&&(o=u.seconds,l=u.time),i.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==s.time&&(a={state:c.state,time:c.time,seconds:o})),i=c}),this._state.remove(s),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const s=this._tickOffset.get(t),r=this._state.get(t),i=Math.max(s.time,r.time),o=this.frequency.getTicksAtTime(i)+e-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,s){let r=this._state.get(e);this._state.forEachBetween(e,t,o=>{r&&r.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(r.time,e),o.time-this.sampleTime,s),r=o});let i=null;if(r&&r.state==="started"){const o=Math.max(r.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(r.time),l=a-c;let u=Math.ceil(l)-l;u=qe(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(d){i=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class jn extends Ee{constructor(){const e=P(jn.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=X,this._lastUpdate=0,this._state=new Hr("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new Yr({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Q(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ee.getDefaults(),{callback:X,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){Sa(this.context);const s=this.toSeconds(e);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,t),s<this._lastUpdate&&this.emit("start",s,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const s=this.toSeconds(t),r=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(r+e,s)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,s=>{switch(s.state){case"started":const r=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,r);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(e,t,(s,r)=>{this.callback(s,r)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}zs.mixin(jn);class rs extends L{constructor(){const e=P(rs.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const t=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(t,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(t),this.delayTime=new Z({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),Q(this,"delayTime")}static getDefaults(){return Object.assign(L.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class ws extends L{constructor(){const e=P(ws.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new K({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Q(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(L.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Kr extends L{constructor(){const e=P(Kr.getDefaults(),arguments);super(e),this.name="Destination",this.input=new ws({context:this.context}),this.output=new K({context:this.context}),this.volume=this.input.volume,Ms(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(L.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),Ms(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Rn(n=>{n.destination=new Kr({context:n})});Dn(n=>{n.destination.dispose()});class Om extends L{constructor(){super(...arguments),this.name="Listener",this.positionX=new Z({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Z({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Z({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Z({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Z({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Z({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Z({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Z({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Z({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(L.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Rn(n=>{n.listener=new Om({context:n})});Dn(n=>{n.listener.dispose()});function Em(n,e){return de(this,arguments,void 0,function*(t,s,r=2,i=Oe().sampleRate){const o=Oe(),a=new Hs(r,s,i);yr(a),yield t(a);const c=a.render();yr(o);const l=yield c;return new Y(l)})}class Qr extends ct{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=P(Qr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const s=e.urls[t];this.add(t,s,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:X,onload:X,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return B(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,s=X,r=X){return it(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Y(this.baseUrl+t,s,r))):this._buffers.set(e.toString(),new Y(t,s,r)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Kt extends Es{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Im extends Ee{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Le,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Rn(n=>{n.draw=new Im({context:n})});Dn(n=>{n.draw.dispose()});class Nm extends ct{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){B(H(e.time),"Events must have a time property"),B(H(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new Rm(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const s of t)if(s.event===e){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let s,r=null;if(t>0)if(e.left.right===null)s=e.left,s.right=e.right,r=s;else{for(s=e.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,r=s.parent,s.left=e.left,s.right=e.right)}else if(e.right.left===null)s=e.right,s.left=e.left,r=s;else{for(s=e.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,r=s.parent,s.left=e.left,s.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=s:e.parent.right=s:this._setRoot(s),r&&this._rebalance(r)}e.dispose()}_rotateLeft(e){const t=e.parent,s=e.isLeftChild(),r=e.right;r&&(e.right=r.left,r.left=e),t!==null?s?t.left=r:t.right=r:this._setRoot(r)}_rotateRight(e){const t=e.parent,s=e.isLeftChild(),r=e.left;r&&(e.left=r.right,r.right=e),t!==null?s?t.left=r:t.right=r:this._setRoot(r)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let s=t[0];for(let r=1;r<t.length;r++)t[r].low>s.low&&(s=t[r]);return s.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(s=>t.push(s)),t.forEach(s=>{s.event&&e(s.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const s=[];this._root.search(e,s),s.forEach(r=>{r.event&&t(r.event)})}return this}forEachFrom(e,t){if(this._root!==null){const s=[];this._root.searchAfter(e,s),s.forEach(r=>{r.event&&t(r.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class Rm{constructor(e,t,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Dm extends ct{constructor(e){super(),this.name="TimelineValue",this._timeline=new Le({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Ye extends L{constructor(){super(P(Ye.getDefaults(),arguments,["context"]))}connect(e,t=0,s=0){return Mn(this,e,t,s),this}}class bs extends Ye{constructor(){const e=P(bs.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Be(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):nm(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ae.getDefaults(),{length:1024})}setMap(e,t=1024){const s=new Float32Array(t);for(let r=0,i=t;r<i;r++){const o=r/(i-1)*2-1;s[r]=e(o,r)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(s=>s.includes(e));B(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ei extends Ye{constructor(){const e=P(ei.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new bs({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Ye.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class yt{constructor(e,t){this.id=yt._eventId++,this._remainderTime=0;const s=Object.assign(yt.getDefaults(),t);this.transport=e,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:X,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}yt._eventId=0;class ti extends yt{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(ti.getDefaults(),t);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},yt.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return vn(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Kt(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){vn(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Kt(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);ls(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Fn extends Ee{constructor(){const e=P(Fn.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new Dm(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Le,this._repeatedEvents=new Nm,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new jn({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Q(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Ee.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const s=t%(this._swingTicks*2)/(this._swingTicks*2),r=Math.sin(s*Math.PI)*this._swingAmount;e+=new Kt(this.context,this._swingTicks*2/3).toSeconds()*r}oo(!0),this._timeline.forEachAtTime(t,s=>s.invoke(e)),oo(!1)}schedule(e,t){const s=new yt(this,{callback:e,time:new Es(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(e,t,s,r=1/0){const i=new ti(this,{callback:e,duration:new Ue(this.context,r).toTicks(),interval:new Ue(this.context,t).toTicks(),time:new Es(this.context,s).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const s=new yt(this,{callback:e,once:!0,time:new Es(this.context,t).toTicks()});return this._addEvent(s,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(t,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new Kt(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let s;return H(t)&&(s=this.toTicks(t)),this._clock.start(e,s),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Be(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Ue(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Ue(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Kt(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Kt(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),s=this._clock.frequency.timeToTicks(e,t);this.ticks=s}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(t),r=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,t),i=t+r;this.emit("stop",i),this._clock.setTicksAtTime(e,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),s=this.getTicksAtTime(t),r=e-s%e;return this._clock.nextTickTime(r,t)}}syncSignal(e,t){const s=this.now();let r=this.bpm,i=1/(60/r.getValueAtTime(s)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/i,l=new K(c),u=new ei(-1),h=new K(c);r.chain(l,u,h),r=h,i=1/i,o=[l,u,h]}t||(e.getValueAtTime(s)!==0?t=e.getValueAtTime(s)/i:t=0);const a=new K(t);return r.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const s=this._syncedSignals[t];s.signal===e&&(s.nodes.forEach(r=>r.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Ia(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}zs.mixin(Fn);Rn(n=>{n.transport=new Fn({context:n})});Dn(n=>{n.transport.dispose()});class Ce extends L{constructor(e){super(e),this.input=void 0,this._state=new Hr("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=X,this._syncedStop=X,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ws({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Q(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(L.getDefaults(),{mute:!1,onstop:X,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,s){let r=Ve(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(r=this._clampToCurrentTime(r),!this._synced&&this._state.getValueAtTime(r)==="started")B(ls(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,t,s);else if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const i=this._state.get(r);i&&(i.offset=this.toSeconds(ns(t,0)),i.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,s)},r);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else Sa(this.context),this._start(r,t,s);return this}stop(e){let t=Ve(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||H(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const s=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(s)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,s){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(ls(t,0)){const s=this._state.get(t);if(s&&s.state==="started"&&s.time!==t){const r=t-this.toSeconds(s.time);let i;s.duration&&(i=this.toSeconds(s.duration)-r),this._start(e,this.toSeconds(s.offset)+r,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=X,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Js extends us{constructor(){const e=P(Js.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,ot(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Z({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Y(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(us.getDefaults(),{url:new Y,loop:!1,loopEnd:0,loopStart:0,onload:X,onerror:X,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,s,r=1){B(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,r),this.loop?t=ns(t,this.loopStart):t=ns(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;gr(o,a)&&(o=(o-c)%l+c),qe(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,vn(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),H(s)){let a=this.toSeconds(s);a=Math.max(a,0),this.stop(i+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class bn extends Ce{constructor(){const e=P(bn.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ce.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(B(e in co,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=co[this._type];this._source=new Js({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Jt=44100*5,Qn=2,tt={brown:null,pink:null,white:null},co={get brown(){if(!tt.brown){const n=[];for(let e=0;e<Qn;e++){const t=new Float32Array(Jt);n[e]=t;let s=0;for(let r=0;r<Jt;r++){const i=Math.random()*2-1;t[r]=(s+.02*i)/1.02,s=t[r],t[r]*=3.5}}tt.brown=new Y().fromArray(n)}return tt.brown},get pink(){if(!tt.pink){const n=[];for(let e=0;e<Qn;e++){const t=new Float32Array(Jt);n[e]=t;let s,r,i,o,a,c,l;s=r=i=o=a=c=l=0;for(let u=0;u<Jt;u++){const h=Math.random()*2-1;s=.99886*s+h*.0555179,r=.99332*r+h*.0750759,i=.969*i+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=s+r+i+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}tt.pink=new Y().fromArray(n)}return tt.pink},get white(){if(!tt.white){const n=[];for(let e=0;e<Qn;e++){const t=new Float32Array(Jt);n[e]=t;for(let s=0;s<Jt;s++)t[s]=Math.random()*2-1}tt.white=new Y().fromArray(n)}return tt.white}};function Ft(n,e){return de(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,s=new Hs(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class si extends us{constructor(){const e=P(si.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],ot(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Z({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Z({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Q(this,["frequency","detune"])}static getDefaults(){return Object.assign(us.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class he extends Ce{constructor(){const e=P(he.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new ae({context:this.context,units:"frequency",value:e.frequency}),Q(this,"frequency"),this.detune=new ae({context:this.context,units:"cents",value:e.detune}),Q(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Ce.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),s=new si({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return he._periodicWaveCache.find(t=>t.phase===this._phase&&pm(t.partials,this._partials));{const e=he._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const s=this._getCachedPeriodicWave();if(H(s)){const{partials:r,wave:i}=s;this._wave=i,this._partials=r,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[r,i]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(r,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),he._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:r,type:this._type,wave:this._wave}),he._periodicWaveCache.length>100&&he._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Xe(e,0);let t=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(t=s[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const r=new Float32Array(e);this._partials.forEach((i,o)=>r[o]=i),this._partials=Array.from(r),this.type=this._type}}_getRealImaginary(e,t){let r=2048;const i=new Float32Array(r),o=new Float32Array(r);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,r=a,this._partials.length===0)return[i,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),r=a):this._partialCount=0,this._partials=[]}for(let c=1;c<r;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(i[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(i[c]=0,o[c]=0)}return[i,o]}_inverseFFT(e,t,s){let r=0;const i=e.length;for(let o=0;o<i;o++)r+=e[o]*Math.cos(o*s)+t[o]*Math.sin(o*s);return r}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let s=0;const r=Math.PI*2,i=32;for(let o=0;o<i;o++)s=Math.max(this._inverseFFT(e,t,o/i*r),s);return _m(-this._inverseFFT(e,t,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}he._periodicWaveCache=[];class Pa extends Ye{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new bs({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Dt extends ae{constructor(){const e=P(Dt.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new K({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ae.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Vn extends Ce{constructor(){const e=P(Vn.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new Pa({context:this.context}),this._modulationNode=new K({context:this.context}),this._carrier=new he({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new he({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Dt({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Q(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(he.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Ln extends Ce{constructor(){const e=P(Ln.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new K({context:this.context,gain:0}),this._carrier=new he({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ae({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new he({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Dt({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Dt({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Q(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(he.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Zs extends Ce{constructor(){const e=P(Zs.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new K({context:this.context,gain:0}),this._thresh=new bs({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new ae({context:this.context,units:"audioRange",value:e.width}),this._triangle=new he({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Q(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Ce.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class $n extends Ce{constructor(){const e=P($n.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new ae({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ae({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Q(this,["frequency","detune"])}static getDefaults(){return Object.assign(he.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,s=e/(this._oscillators.length-1);this._forEach((r,i)=>r.detune.value=t+s*i)}}get count(){return this._oscillators.length}set count(e){if(Xe(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const s=new he({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):X});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[t]=s}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,s)=>t.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class qn extends Ce{constructor(){const e=P(qn.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Dt({context:this.context,value:2}),this._pulse=new Zs({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new he({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Q(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Ce.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const lo={am:Vn,fat:$n,fm:Ln,oscillator:he,pulse:Zs,pwm:qn};class Tn extends Ce{constructor(){const e=P(Tn.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new ae({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ae({context:this.context,units:"cents",value:e.detune}),Q(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(he.getDefaults(),Ln.getDefaults(),Vn.getDefaults(),$n.getDefaults(),Zs.getDefaults(),qn.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=lo[e],s=this.now();if(this._oscillator){const r=this._oscillator;r.stop(s),this.context.setTimeout(()=>r.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof lo[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Nt(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Nt(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&it(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return de(this,arguments,void 0,function*(e=1024){return Ft(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class ni extends ae{constructor(){super(P(ni.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new K({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Ms(this._constantSource,this._sum)}static getDefaults(){return Object.assign(ae.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class ri extends Ye{constructor(){const e=P(ri.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new Dt({context:this.context,value:e.max-e.min}),this._add=this.output=new ni({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ye.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class ii extends Ye{constructor(){super(P(ii.getDefaults(),arguments)),this.name="Zero",this._gain=new K({context:this.context}),this.output=this._gain,this.input=void 0,ot(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),Da(this.context.getConstant(0),this._gain),this}}class Is extends L{constructor(){const e=P(Is.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Z.prototype._fromType,this._toType=Z.prototype._toType,this._is=Z.prototype._is,this._clampValue=Z.prototype._clampValue,this._oscillator=new he(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new K({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new ae({context:this.context,units:"audioRange",value:0}),this._zeros=new ii({context:this.context}),this._a2g=new Pa({context:this.context}),this._scaler=this.output=new ri({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Q(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(he.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const t=this.min,s=this.max;this._units=e,this.min=t,this.max=s}get state(){return this._oscillator.state}connect(e,t,s){return(e instanceof Z||e instanceof ae)&&(this.convert=e.convert,this.units=e.units),Mn(this,e,t,s),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Ma(n,e=1/0){const t=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){Xe(i,n,e),t.set(this,i)}})}}function lt(n,e=1/0){const t=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){Xe(this.toSeconds(i),n,e),t.set(this,i)}})}}class Xs extends Ce{constructor(){const e=P(Xs.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Y({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ce.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:X,onerror:X,playbackRate:1,reverse:!1})}load(e){return de(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=X){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,s){return super.start(e,t,s),this}_start(e,t,s){this._loop?t=ns(t,this._loopStart):t=ns(t,0);const r=this.toSeconds(t),i=s;s=ns(s,Math.max(this._buffer.duration-r,0));let o=this.toSeconds(s);o=o/this._playbackRate,e=this.toSeconds(e);const a=new Js({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Ve(i)?a.start(e,r):a.start(e,r,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(s=>s.stop(t))}restart(e,t,s){return super.restart(e,t,s),this}_restart(e,t,s){var r;(r=[...this._activeSources].pop())===null||r===void 0||r.stop(e),this._start(e,t,s)}seek(e,t){const s=this.toSeconds(t);if(this._state.getValueAtTime(s)==="started"){const r=this.toSeconds(e);this._stop(s),this._start(s,r)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Xe(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Xe(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),s=this._state.getNextState("stopped",t);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(r=>r.cancelStop())),this._activeSources.forEach(r=>{r.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}He([lt(0)],Xs.prototype,"fadeIn",void 0);He([lt(0)],Xs.prototype,"fadeOut",void 0);class Pm extends Ye{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new bs({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Tt extends L{constructor(){const e=P(Tt.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new ae({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(L.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(it(e))return e;{let s;for(s in on)if(on[s][t]===e)return s;return e}}_setCurve(e,t,s){if(it(s)&&Reflect.has(on,s)){const r=on[s];Et(r)?e!=="_decayCurve"&&(this[e]=r[t]):this[e]=r}else if(Be(s)&&e!=="_decayCurve")this[e]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let r=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/r;r=(1-o)/a}if(r<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,r,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,r,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,r,t)}if(i&&this.sustain<1){const a=t*this.sustain,c=e+r;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,i+c):this._sig.exponentialApproachValueAtTime(a,c,i)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,e):(B(Be(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,s,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,s=1){return t=this.toSeconds(t),this.triggerAttack(t,s),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,s=0){return Mn(this,e,t,s),this}asArray(){return de(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,s=new Hs(1,t,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=r+this.toSeconds(this.release),o=i*.1,a=i+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:s}));return c._sig.toDestination(),c.triggerAttackRelease(t*(r+o)/a,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}He([lt(0)],Tt.prototype,"attack",void 0);He([lt(0)],Tt.prototype,"decay",void 0);He([Ma(0,1)],Tt.prototype,"sustain",void 0);He([lt(0)],Tt.prototype,"release",void 0);const on=(()=>{let e,t;const s=[];for(e=0;e<128;e++)s[e]=Math.sin(e/127*(Math.PI/2));const r=[],i=6.4;for(e=0;e<127;e++){t=e/127;const d=Math.sin(t*(Math.PI*2)*i-Math.PI/2)+1;r[e]=d/10+t*.83}r[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/127;const d=Math.pow(t,3)*4+.2,f=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(f*(1-t))}function u(d){const f=new Array(d.length);for(let p=0;p<d.length;p++)f[p]=1-d[p];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:r,Out:u(r)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class hs extends L{constructor(){const e=P(hs.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new ws({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Q(this,"volume")}static getDefaults(){return Object.assign(L.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const s=this["_original_"+e]=this[e];this[e]=(...r)=>{const i=r[t],o=this.context.transport.schedule(a=>{r[t]=a,s.apply(this,r)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,s,r){const i=this.toSeconds(s),o=this.toSeconds(t);return this.triggerAttack(e,i,r),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class ds extends hs{constructor(){const e=P(ds.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(hs.getDefaults(),{detune:0,onsilence:X,portamento:0})}triggerAttack(e,t,s=1){this.log("triggerAttack",e,t,s);const r=this.toSeconds(t);return this._triggerEnvelopeAttack(r,s),this.setNote(e,r),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const s=this.toSeconds(t),r=e instanceof Fe?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,i,s)}else this.frequency.setValueAtTime(r,s);return this}}He([lt(0)],ds.prototype,"portamento",void 0);class oi extends Tt{constructor(){super(P(oi.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new K({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class kn extends ds{constructor(){const e=P(kn.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Tn(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new oi(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Q(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(ds.getDefaults(),{envelope:Object.assign(ao(Tt.getDefaults(),Object.keys(L.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(ao(Tn.getDefaults(),[...Object.keys(Ce.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+s+r)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Un extends kn{constructor(){const e=P(Un.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Q(this,["oscillator","envelope"])}static getDefaults(){return ss(ds.getDefaults(),kn.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const s=this.toSeconds(t),r=this.toFrequency(e instanceof Fe?e.toFrequency():e),i=r*this.octaves;return this.oscillator.frequency.setValueAtTime(i,s),this.oscillator.frequency.exponentialRampToValueAtTime(r,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}He([Ma(0)],Un.prototype,"octaves",void 0);He([lt(0)],Un.prototype,"pitchDecay",void 0);const ai=new Set;function ci(n){ai.add(n)}function ja(n,e){const t=`registerProcessor("${n}", ${e})`;ai.add(t)}function Mm(){return Array.from(ai).join(`
`)}class uo extends L{constructor(e){super(e),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=X;const t=URL.createObjectURL(new Blob([Mm()],{type:"text/javascript"})),s=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(t).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(s,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}const jm=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;ci(jm);const Fm=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;ci(Fm);const Vm=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;ci(Vm);const Lm="feedback-comb-filter",$m=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;ja(Lm,$m);class Bn extends hs{constructor(){const e=P(Bn.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(s=>{const r=parseInt(s,10);if(B(rn(s)||Nt(r)&&isFinite(r),`url key is neither a note or midi pitch: ${s}`),rn(s)){const i=new Fe(this.context,s).toMidi();t[i]=e.urls[s]}else Nt(r)&&isFinite(r)&&(t[r]=e.urls[r])}),this._buffers=new Qr({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(hs.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:X,onerror:X,release:.1,urls:{}})}_findClosest(e){let s=0;for(;s<96;){if(this._buffers.has(e+s))return-s;if(this._buffers.has(e-s))return s;s++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,s=1){return this.log("triggerAttack",e,t,s),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=Ra(new Fe(this.context,r).toFrequency()),o=Math.round(i),a=i-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=wn(c+a),d=new Js({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,s),Be(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const f=this._activeSources.get(o),p=f.indexOf(d);p!==-1&&f.splice(p,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(s=>{const r=new Fe(this.context,s).toMidi();if(this._activeSources.has(r)&&this._activeSources.get(r).length){const i=this._activeSources.get(r);t=this.toSeconds(t),i.forEach(o=>{o.stop(t)}),this._activeSources.set(r,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,s,r=1){const i=this.toSeconds(s);return this.triggerAttack(e,i,r),Be(t)?(B(Be(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,i+this.toSeconds(c))})):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,s){if(B(rn(e)||isFinite(e),`note must be a pitch or midi: ${e}`),rn(e)){const r=new Fe(this.context,e).toMidi();this._buffers.add(r,t,s)}else this._buffers.add(e,t,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}He([lt(0)],Bn.prototype,"attack",void 0);He([lt(0)],Bn.prototype,"release",void 0);class Wn extends L{constructor(){const e=P(Wn.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Pm({context:this.context}),this.a=new K({context:this.context,gain:0}),this.b=new K({context:this.context,gain:0}),this.output=new K({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new ae({context:this.context,units:"normalRange",value:e.fade}),Q(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",ot(this._split,this.a.gain,0),ot(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(L.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class fs extends L{constructor(e){super(e),this.name="Effect",this._dryWet=new Wn({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new K({context:this.context}),this.effectReturn=new K({context:this.context}),this.input=new K({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Q(this,"wet")}static getDefaults(){return Object.assign(L.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class li extends L{constructor(){const e=P(li.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Z({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Q(this,"pan")}static getDefaults(){return Object.assign(L.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const Fa="bit-crusher",qm=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;ja(Fa,qm);class ui extends fs{constructor(){const e=P(ui.getDefaults(),arguments,["bits"]);super(e),this.name="BitCrusher",this._bitCrusherWorklet=new hi({context:this.context,bits:e.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(fs.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class hi extends uo{constructor(){const e=P(hi.getDefaults(),arguments);super(e),this.name="BitCrusherWorklet",this.input=new K({context:this.context}),this.output=new K({context:this.context}),this.bits=new Z({context:this.context,value:e.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(uo.getDefaults(),{bits:12})}_audioWorkletName(){return Fa}onReady(e){Ms(this.input,e,this.output);const t=e.parameters.get("bits");this.bits.setParam(t)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class di extends L{constructor(){const e=P(di.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(L.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Sn extends fs{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new K({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Q(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(fs.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class fi extends Sn{constructor(){const e=P(fi.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new rs({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Q(this,"delayTime")}static getDefaults(){return Object.assign(Sn.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class pi extends Sn{constructor(){const e=P(pi.getDefaults(),arguments,["pitch"]);super(e),this.name="PitchShift",this._frequency=new ae({context:this.context}),this._delayA=new rs({maxDelay:1,context:this.context}),this._lfoA=new Is({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new rs({maxDelay:1,context:this.context}),this._lfoB=new Is({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new Wn({context:this.context}),this._crossFadeLFO=new Is({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new rs({delayTime:e.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Q(this,"delayTime"),this._pitch=e.pitch,this._windowSize=e.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const t=this.now();this._lfoA.start(t),this._lfoB.start(t),this._crossFadeLFO.start(t),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Sn.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(e){this._pitch=e;let t=0;e<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,t=wn(e-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,t=wn(e)-1),this._frequency.value=t*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(e){this._windowSize=this.toSeconds(e),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class mi extends fs{constructor(){const e=P(mi.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve(),this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(fs.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Xe(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Xe(e,0),this._preDelay=e,this.generate()}generate(){return de(this,void 0,void 0,function*(){const e=this.ready,t=new Hs(2,this._decay+this._preDelay,this.context.sampleRate),s=new bn({context:t}),r=new bn({context:t}),i=new di({context:t});s.connect(i,0,0),r.connect(i,0,1);const o=new K({context:t}).toDestination();i.connect(o),s.start(0),r.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(X),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class pe extends L{constructor(){const e=P(pe.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new K({context:this.context}),pe._allSolos.has(this.context)||pe._allSolos.set(this.context,new Set),pe._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(L.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),pe._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){pe._soloed.has(this.context)||pe._soloed.set(this.context,new Set),pe._soloed.get(this.context).add(this)}_removeSolo(){pe._soloed.has(this.context)&&pe._soloed.get(this.context).delete(this)}_isSoloed(){return pe._soloed.has(this.context)&&pe._soloed.get(this.context).has(this)}_noSolos(){return!pe._soloed.has(this.context)||pe._soloed.has(this.context)&&pe._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),pe._allSolos.get(this.context).delete(this),this._removeSolo(),this}}pe._allSolos=new Map;pe._soloed=new Map;class _i extends L{constructor(){const e=P(_i.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new li({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new ws({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Q(this,["pan","volume"])}static getDefaults(){return Object.assign(L.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Qt extends L{constructor(){const e=P(Qt.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new pe({solo:e.solo,context:this.context}),this._panVol=this.output=new _i({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Q(this,["pan","volume"])}static getDefaults(){return Object.assign(L.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Qt.buses.has(e)||Qt.buses.set(e,new K({context:this.context})),Qt.buses.get(e)}send(e,t=0){const s=this._getBus(e),r=new K({context:this.context,units:"decibels",gain:t});return this.connect(r),r.connect(s),r}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Qt.buses=new Map;Oe().transport;const Um=Oe().destination;Oe().destination;Oe().listener;Oe().draw;const Bm=Oe(),gi=Zl("https://uytyxroguktgsymkkoke.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5dHl4cm9ndWt0Z3N5bWtrb2tlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2NDc2MDQsImV4cCI6MjA1ODIyMzYwNH0.Yn6-gOjT3ZRJvAaO-czhb0IME5JP5g2IEi97TbAA_BU");let es,Va,er=[],wr=!1;window.onload=function(){console.log("  Supabase ..."),La()};async function La(){const{data:n,error:e}=await gi.from("dreams").select("*").order("created_at",{ascending:!1});if(e){console.error("  Supabase :",e);return}n.forEach(t=>{Wm(t.id,t.text,t.audio_base64)})}async function $a(n,e=null){if(!n||n.trim()===""){console.error(" ");return}const{data:t,error:s}=await gi.from("dreams").insert([{text:n,audio_base64:e,created_at:new Date().toISOString()}]);s?console.error(" :",s):console.log(" :",t)}function Wm(n,e,t=null){const s=document.createElement("div");if(s.classList.add("bubble"),s.dataset.docId=n,!t)s.textContent=e;else{const a=document.createElement("audio");a.src=t,a.controls=!0,s.appendChild(a)}const r=document.createElement("button");r.textContent="X",r.addEventListener("click",async a=>{a.stopPropagation(),await gi.from("dreams").delete().eq("id",n),s.remove()}),s.appendChild(r);const i=Math.random()*(window.innerWidth-100),o=Math.random()*(window.innerHeight-100);s.style.left=`${i}px`,s.style.top=`${o}px`,document.getElementById("bubbleContainer").appendChild(s)}function zm(){navigator.mediaDevices.getUserMedia({audio:!0}).then(n=>{Va=n,er=[],es=new MediaRecorder(n),wr=!0,es.ondataavailable=e=>{e.data.size>0&&er.push(e.data)},es.onstop=async()=>{const e=new Blob(er,{type:"audio/webm"}),t=document.getElementById("bubbleText").value.trim();Hm(e,t)},es.start(5e3)})}function Gm(){es&&wr&&(wr=!1,es.stop(),Va.getTracks().forEach(n=>n.stop()))}async function Hm(n,e){await wm();const t=await n.arrayBuffer(),s=await Oe().rawContext.decodeAudioData(t),r=Math.max(s.duration+1,1),i=await Em(async({transport:c})=>{const l=await Bm.decodeAudioData(t),u=parseFloat(document.getElementById("pitchSlider").value),h=parseFloat(document.getElementById("reverbSlider").value),d=parseInt(document.getElementById("bitSlider").value),f=parseFloat(document.getElementById("delaySlider").value),p=new Xs(l),m=new pi({pitch:u}),_=new ui(d),y=new fi(f),T=new mi({decay:h});p.chain(m,_,y,T,Um),p.start(0),c.start()},r),o=await Jm(i);if(!o||!(o instanceof Blob)){console.error("  Blob ");return}const a=new FileReader;a.readAsDataURL(o),a.onloadend=async()=>{const c=a.result;await $a(e,c)}}function Jm(n){return new Promise(e=>{const t=n.numberOfChannels,s=n.sampleRate,r=n.length*t*2+44,i=new ArrayBuffer(r),o=new DataView(i),a=[];for(let u=0;u<t;u++)a.push(n.getChannelData(u));const c=(u,h,d)=>{for(let f=0;f<d.length;f++)u.setUint8(h+f,d.charCodeAt(f))};c(o,0,"RIFF"),o.setUint32(4,r-8,!0),c(o,8,"WAVE"),c(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,t,!0),o.setUint32(24,s,!0),o.setUint32(28,s*t*2,!0),o.setUint16(32,t*2,!0),o.setUint16(34,16,!0),c(o,36,"data"),o.setUint32(40,r-44,!0);let l=44;for(let u=0;u<n.length;u++)for(let h=0;h<t;h++){let d=Math.max(-1,Math.min(1,a[h][u]));o.setInt16(l,d<0?d*32768:d*32767,!0),l+=2}e(new Blob([o],{type:"audio/wav"}))})}document.addEventListener("DOMContentLoaded",()=>{console.log(" "),La();const n=document.getElementById("bubbleText"),e=document.getElementById("bubbleBtn"),t=document.getElementById("recordBtn"),s=document.getElementById("stopRecordBtn");if(!n||!e||!t||!s){console.error("  HTML  ID");return}e.addEventListener("click",async()=>{const r=n.value.trim();if(!r){console.error("  Supabase");return}console.log(" :",r),await $a(r,null)}),t.addEventListener("click",()=>{console.log(" ..."),zm()}),s.addEventListener("click",()=>{console.log(" ..."),Gm()})});export{Qa as g};
